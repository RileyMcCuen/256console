{"version":3,"sources":["aws/aws-constants.ts","aws/db.ts","redux/actions.ts","aws/mturk.ts","components/db-status.tsx","components/project-iteration-selector.tsx","redux/reducers.ts","redux/store.ts","components/update-projects.tsx","components/table.tsx","aws/aws-service.ts","components/file-input.tsx","components/login.tsx","components/button-with-description.tsx","components/hit-generator.tsx","app/App.tsx","components/toggle.tsx","components/account-balances.tsx","components/submit-hits.tsx","components/cancel-hits.tsx","components/download-zip.tsx","components/pay-hits.tsx","components/hit-status.tsx","components/tab.tsx","service-worker/serviceWorker.ts","index.tsx"],"names":["METHODS","Region","BaseURL","process","Types","table","PrimaryKey","name","prefix","metaDataKeyName","metaDataType","this","pk","parsePrefixRegEx","exec","data","toMetaData","key","parseDataRegEx","SortKey","metaDataKeyNames","metaDataTypes","prefixRegEx","test","Error","sk","values","slice","split","length","ret","forEach","value","index","push","obj","val","undefined","indexOf","AEntity","type","Str","Bool","trim","toLowerCase","Num","Number","Object","keys","primaryKey","getMetaDataKeyName","convert","toMetaDataFromData","getMetaDataType","sortKey","metaData","getMetaDataTypes","getMetaDataKeyNames","includes","DynamoDB","Converter","marshall","ClassTable","fetchClient","Name","PKName","SKName","addEntity","HIT","ProjectDescription","entity","delete","PKMeta","SKMeta","get","query","PK","sortKeyPrefix","map","item","wustlKey","sortKeyData","pkName","skName","entities","Map","mapMap","primaryKeyPrefix","set","KeyType","AttributeName","AttributeType","url","request","fetch","json","method","GET","headers","fetchJSON","resp","TableNames","POST","body","JSON","stringify","TableName","getName","Item","toDBForm","deleted","console","log","put","puted","getKey","Key","unmarshall","ctor","getEntityConstructor","getPrefixFromPK","getPrefixFromSK","DELETE","keyConditionExpression","expressionAttributeValues","KeyConditionExpression","ExpressionAttributeValues","ClassTableEntity","Task","tag","description","ProjectName","Tasks","parsedTags","construct","parse","task","tasks","toString","WUSTLKey","Iteration","HITName","Cnt","AWSIDs","projectName","iteration","hitName","cnt","awsIDs","Log","HITID","AssignmentID","WorkerID","hitID","assignmentID","workerID","EDBStatus","MTPool","accts","sandboxAccts","realAccts","accessID","accessSecret","addRealAccount","AWS","MTurk","region","endpoint","credentials","accessKeyId","secretAccessKey","addSandboxAccount","acct","sandbox","MTurkMode","SANDBOX","fun","Promise","resolve","reject","getAccountBalance","err","balance","AvailableBalance","setSandbox","forp","a","urls","urlsForStud","urlCountPair","count","setTimeout","createHIT","AssignmentDurationInSeconds","AutoApprovalDelayInSeconds","Description","LifetimeInSeconds","MaxAssignments","Reward","price","Title","Question","MTurkPool","HitConfig","error","code","message","promise","listHITs","hits","HITs","hit","updateExpirationForHIT","ExpireAt","Date","HITId","i","row","approveAssignment","AssignmentId","$response","rejectAssignment","RequesterFeedback","sendBonus","WorkerId","BonusAmount","Reason","UniqueRequestToken","Data","promises","entry","reduce","prev","cur","available","NumberOfAssignmentsAvailable","pending","NumberOfAssignmentsPending","completed","Math","max","HITStatus","sEntry","SubmitHITDataType","LoginStatus","header","find","every","queryTerm","expectedValue","login","loggedIn","SUCCEEDED","logout","FAILED","updateProjects","projects","sortedProjects","sort","b","currentProject","Create","updateSPIData","spiData","updateStudents","students","stud","add","id","secret","updateMTurkMode","mturkMode","fetchSPIData","dispatch","e","fetchAccountBalances","getAccountBalances","all","balances","accountBalances","mapDispatchToProps","updateDBStatus","dbStatus","connector","connect","state","className","onClick","props","exists","Created","DoesNotExist","Unknown","renderCheck","status","React","Component","updateCurrentProject","updateCurrentIteration","currentIteration","iterations","onChange","ev","target","selectedIndex","project","parseInt","num","ffor","defaultState","UNATTEMPTED","submitHITData","dataType","COUNT_NOT_GIVEN","store","createStore","action","reducerHelper","updates","assign","lin","lout","udbs","up","ui","ucp","uci","uspid","us","ub","ushd","umm","compose","applyMiddleware","thunk","UpdateProject","inputElem","createRef","tagInputElem","selected","editing","event","stopPropagation","select","disabled","ref","setState","current","focus","update","FileDrop","onDrop","files","reader","FileReader","addEventListener","parsed","result","Array","isArray","context","question","alert","readAsText","newInput","projectSave","deleteEntity","filter","newVal","callback","placeholder","newProjectName","csvp","require","updateSubmitHITData","Compiler","filterExpr","expr","tok","k","ind","tokens","conds","eq","input","amper","conditions","cond","evaluate","lex","instance","Table","fileInput","displayTable","compiler","setData","csv","hk","COUNT_GIVEN","accept","file","fr","onloadend","readyState","DONE","out","updateCSVData","htmlFor","dispData","execute","renderFileInput","setFilterExpression","DataTable","IdentityPoolId","config","CognitoIdentityCredentials","UploadStatus","userPool","CognitoUserPool","UserPoolId","ClientId","cognitoUser","getCurrentUser","awsFetchClient","createCredentials","Logins","getIdToken","getJwtToken","refreshCredentials","fail","refresh","AwsClient","sessionToken","expired","createTable","dbCreateTable","asyncStore","getProjectNames","nullifyAllServiceGlobals","clearIncorrectUserdata","awsLogin","username","password","CognitoUser","Username","Pool","authenticationDetails","AuthenticationDetails","Password","authenticateUser","onSuccess","onFailure","newPasswordRequired","userAttributes","requiredAttributes","completeNewPasswordChallenge","session","getSession","awsLogout","signOut","downloadAllFiles","text","b64","byteString","atob","ab","ArrayBuffer","ia","Uint8Array","charCodeAt","Blob","Login","usernameField","passwordField","onSubmit","preventDefault","autoComplete","Logout","ButtonWithDescription","display","buttonClass","buttonTitle","Generated","fileUploaded","NO_UPLOAD","onFileChange","validateStudents","studData","SUCCESS","FAILURE","FileInput","NavLocation","rands","ri","floor","random","newSPIData","studSPI","pis","tags","threeRands","generated","LOADING","some","pi","GENERATED","NOT_GENERATED","generate","Toggle","active","toggles","toggle","mapDispatchToSandboxToggleProps","SandboxToggle","sandboxToggleConnector","REAL","aVal","parseFloat","bVal","pair","ready","activeTable","errors","projData","iterData","taskData","taskTag","hitData","wKey","countSoFar","studConfig","studProjConfig","studHitConfigData","buildURL","buildFromCountGiven","buildFromCountNotGiven","buildURLS","uploadHits","resetValues","re","findFirstEntry","toFixed","min","step","getDiffData","cancelHits","document","createElement","style","appendChild","href","window","URL","createObjectURL","setAttribute","click","revokeObjectURL","removeChild","download","payHits","getStatuses","Tab","tabRef","tab","urlName","actions","findIndex","children","component","SemesterManagementTab","HitManagementTab","PostHitManagementTab","SessionManagementTab","uri","encodeURIComponent","remove","NavBar","rs","fill","currentActive","navLocation","SemesterManagement","oldActive","classList","onUpdateActive","startNavLocation","updateActive","str","charAt","toUpperCase","join","Footer","title","Tabs","HITManagement","PostHITManagement","SessionManagement","loc","location","hash","path","displayName","then","reason","catch","Boolean","hostname","match","ReactDOM","render","getElementById","navigator","serviceWorker","registration","unregister"],"mappings":"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","file":"static/js/main.00799fac.chunk.js","sourcesContent":["export const Region = 'us-east-1';\r\nexport const BaseURL = process.env.REACT_APP_BASE_URL;\r\nexport const TableName = process.env.REACT_APP_TABLE_NAME;\r\n\r\nexport enum METHODS {\r\n    GET= 'GET',\r\n    POST = 'POST',\r\n    PUT = 'PUT',\r\n    DELETE = 'DELETE'\r\n}\r\n\r\nexport const AppJSONHeaders = () => {\r\n    return {\r\n        'Content-Type': 'application/json'\r\n    }\r\n}","import DynamoDB from \"aws-sdk/clients/dynamodb\";\r\nimport {AppJSONHeaders, BaseURL, METHODS, TableName} from \"./aws-constants\";\r\nimport {AwsClient} from \"aws4fetch\";\r\n//\r\n// {\r\n//     \"TableName\": \"CSE256-Data-Testing\",\r\n//     \"Key\": {\r\n//          \"PKMeta\": {\"S\": \"#CLASS:ProjectName\"},\r\n//          \"SKMeta\": {\"S\": \"#PROJECT_NAME:Cognitive Load\"}\r\n//     }\r\n// }\r\n//\r\n\r\nexport let table: ClassTable | null = null;\r\n\r\nexport const createTable = (awsFetchClient: AwsClient) => {\r\n    table = new ClassTable(awsFetchClient);\r\n}\r\n\r\nexport const getTable = () => {\r\n    return table;\r\n}\r\n\r\nenum Types {\r\n    Bool,\r\n    Num,\r\n    Str\r\n}\r\n\r\nclass PrimaryKey {\r\n\r\n    public static readonly parsePrefixRegEx = /^#([a-zA-Z0-9_.]+):/;\r\n    public static readonly parseDataRegEx = /^#[a-zA-Z0-9_.]+:([a-zA-Z0-9_.]+)/;\r\n\r\n    public static getPrefixFromPK(pk: string): string {\r\n        return (PrimaryKey.parsePrefixRegEx.exec(pk) as RegExpExecArray)[1];\r\n    }\r\n\r\n    private readonly name: string;\r\n    private readonly prefix: string;\r\n    private readonly metaDataKeyName: string;\r\n    private readonly metaDataType: Types;\r\n\r\n    constructor(name: string, prefix: string, metaDataKeyName: string, metaDataType: Types) {\r\n        this.name = name;\r\n        this.prefix = prefix;\r\n        this.metaDataKeyName = metaDataKeyName;\r\n        this.metaDataType = metaDataType;\r\n    }\r\n\r\n    getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    getMetaDataKeyName(): string {\r\n        return this.metaDataKeyName;\r\n    }\r\n\r\n    getMetaDataType(): Types {\r\n        return this.metaDataType;\r\n    }\r\n\r\n    toMetaDataFromData(data: DynamoDB.DocumentClient.AttributeMap): string {\r\n        return this.toMetaData(data[this.name]);\r\n    }\r\n\r\n    toMetaData(key: string) {\r\n        return (PrimaryKey.parseDataRegEx.exec(key) as RegExpExecArray)[1];\r\n    }\r\n\r\n    toString(data: string) {\r\n        return `#${this.prefix}:${data}`;\r\n    }\r\n\r\n}\r\n\r\ntype SKMetaData = {\r\n    key: string,\r\n    value: string\r\n}[];\r\n\r\nclass SortKey {\r\n\r\n    public static readonly prefixRegEx = /([a-zA-Z0-9_.]+)/;\r\n    public static readonly parsePrefixRegEx = /^#([a-zA-Z0-9_.]+):/;\r\n\r\n    public static getPrefixFromSK(sk: string): string {\r\n        return (SortKey.parsePrefixRegEx.exec(sk) as RegExpExecArray)[1];\r\n    }\r\n\r\n    private readonly name: string;\r\n    private readonly prefix: string;\r\n    private readonly metaDataKeyNames: string[];\r\n    private readonly metaDataTypes: Types[];\r\n\r\n    constructor(name: string, prefix: string, metaDataKeyNames: string[], metaDataTypes: Types[]) {\r\n        if (!SortKey.prefixRegEx.test(prefix)) {\r\n            throw new Error('Prefix is only allowed to take format: /([a-zA-Z0-9_.]+)/.');\r\n        }\r\n        this.name = name;\r\n        this.prefix = prefix;\r\n        this.metaDataKeyNames = metaDataKeyNames;\r\n        this.metaDataTypes = metaDataTypes;\r\n    }\r\n\r\n    getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    getMetaDataKeyNames(): string[] {\r\n        return this.metaDataKeyNames;\r\n    }\r\n\r\n    getMetaDataTypes(): Types[] {\r\n        return this.metaDataTypes;\r\n    }\r\n\r\n    toMetaDataFromData(data: DynamoDB.DocumentClient.AttributeMap) {\r\n        return this.toMetaData(data[this.name]);\r\n    }\r\n\r\n    toMetaData(key: string): SKMetaData {\r\n        if (key[0] === '#') {\r\n            key = key.slice(1); // Slice pound off of front of string\r\n            const values = key.split(':');\r\n            if ((values.length - 1) === this.metaDataKeyNames.length) {\r\n                const ret: SKMetaData = [];\r\n                values.forEach((value, index) => {\r\n                   if (index > 0) { // Skip prefix string\r\n                       ret.push({\r\n                           key: this.metaDataKeyNames[index - 1],\r\n                           value: value\r\n                       });\r\n                   }\r\n                });\r\n                return ret;\r\n            }\r\n            throw new Error(`Provided key does not have the expected number of values.`)\r\n        }\r\n        throw new Error(`Provided key does not follow expected pattern. Missing '#' at front of string.`)\r\n    }\r\n\r\n    toString(obj: any) {\r\n        let ret = `#${this.prefix}`;\r\n        this.metaDataKeyNames.forEach(key => {\r\n            const val = '' + obj[key];\r\n            if (val === undefined || val === null) {\r\n                throw new Error(`Provided object must have a non-null value for every key in sort key metaData. This object was missing at least this key: ${key}.`);\r\n            }\r\n            if (val.indexOf(':') !== -1 || val.indexOf('#') !== -1) {\r\n                throw new Error('Sort Key meta data cannot include # or : in it. This will ruin the invariant that allows the parser to work.')\r\n            }\r\n            ret += `:${val}`;\r\n        });\r\n        return ret;\r\n    }\r\n}\r\n\r\ninterface EntityConstructor {\r\n    new (data: DynamoDB.DocumentClient.AttributeMap): IEntity;\r\n    readonly sortKeyPrefix: string;\r\n    readonly primaryKeyPrefix: string;\r\n}\r\n\r\ninterface IEntity {\r\n    primaryKey(): PrimaryKey;\r\n    sortKey(): SortKey;\r\n    toDBForm(): DynamoDB.DocumentClient.PutItemInputAttributeMap;\r\n}\r\n\r\nabstract class AEntity implements IEntity {\r\n\r\n    protected constructor() {}\r\n\r\n    convert(data: string, type: Types) {\r\n        switch (type) {\r\n            case Types.Str:\r\n                return data;\r\n            case Types.Bool:\r\n                return data.trim().toLowerCase() === 'true';\r\n            case Types.Num:\r\n                return Number(data);\r\n        }\r\n    }\r\n\r\n    construct(data: DynamoDB.DocumentClient.AttributeMap) {\r\n        Object.keys(data).forEach(key => {\r\n            (this as any)[key] = data[key];\r\n        });\r\n        (this as any)[this.primaryKey().getMetaDataKeyName()] = this.convert(this.primaryKey().toMetaDataFromData(data), this.primaryKey().getMetaDataType());\r\n        this.sortKey()\r\n            .toMetaDataFromData(data)\r\n            .forEach((metaData, index) => {\r\n                (this as any)[metaData.key] = this.convert(metaData.value, this.sortKey().getMetaDataTypes()[index]);\r\n            });\r\n    }\r\n\r\n    toDBForm(): DynamoDB.DocumentClient.PutItemInputAttributeMap {\r\n        const ret = {};\r\n        Object.keys(this).forEach(key => {\r\n            if ((!this.sortKey().getMetaDataKeyNames().includes(key)) && (this.primaryKey().getMetaDataKeyName() !== key)) {\r\n                (ret as any)[key] = (this as any)[key];\r\n            }\r\n        });\r\n        return DynamoDB.Converter.marshall(ret);\r\n    }\r\n\r\n    abstract primaryKey(): PrimaryKey;\r\n\r\n    abstract sortKey(): SortKey;\r\n\r\n}\r\n\r\nclass Table {\r\n\r\n    private readonly fetchClient: AwsClient;\r\n    private readonly name: string;\r\n    private readonly pkName: string;\r\n    private readonly skName: string;\r\n    private readonly entities: Map<string, Map<string, EntityConstructor>>;\r\n\r\n    constructor(fetchClient: AwsClient, name: string, pkName: string, skName: string) {\r\n        this.fetchClient = fetchClient;\r\n        this.name = name;\r\n        this.pkName = pkName;\r\n        this.skName = skName;\r\n        this.entities = new Map<string, Map<string, EntityConstructor>>();\r\n    }\r\n\r\n    //// Misc. helpers\r\n\r\n    addEntity(entity: EntityConstructor): Table {\r\n        let mapMap = this.entities.get(entity.primaryKeyPrefix);\r\n        if (mapMap === undefined || mapMap === null) {\r\n            mapMap = new Map<string, EntityConstructor>();\r\n            this.entities.set(entity.primaryKeyPrefix, mapMap);\r\n        }\r\n        mapMap.set(entity.sortKeyPrefix, entity);\r\n        return this;\r\n    }\r\n\r\n    getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    getEntityConstructor(primaryKeyPrefix: string, sortKeyPrefix: string) {\r\n        return this.entities.get(primaryKeyPrefix)?.get(sortKeyPrefix);\r\n    }\r\n\r\n    getKeySchema() {\r\n        return [\r\n            {\r\n                KeyType: 'HASH',\r\n                AttributeName: this.pkName\r\n            },\r\n            {\r\n                KeyType: 'RANGE',\r\n                AttributeName: this.skName\r\n            }\r\n        ];\r\n    }\r\n\r\n    getAttributeDefinitions() {\r\n        return [\r\n            {\r\n                AttributeName: this.pkName,\r\n                AttributeType: 'S'\r\n            },\r\n            {\r\n                AttributeName: this.skName,\r\n                AttributeType: 'S'\r\n            }\r\n        ];\r\n    }\r\n\r\n    getKey(pk: string, sk: string) {\r\n        const key: any = {};\r\n        key[this.pkName] = pk;\r\n        key[this.skName] = sk;\r\n        return key;\r\n    }\r\n\r\n    async fetchJSON(url: string, request: RequestInit) {\r\n        return (await this.fetchClient.fetch(url, request)).json();\r\n    }\r\n\r\n    //// Table operations:\r\n\r\n    // create(throughput: DynamoDB.ProvisionedThroughput) {\r\n    //     return this.dbClient.createTable({\r\n    //         TableName: this.name,\r\n    //         KeySchema: this.getKeySchema(),\r\n    //         AttributeDefinitions: this.getAttributeDefinitions(),\r\n    //         ProvisionedThroughput: throughput\r\n    //     }).promise();\r\n    // }\r\n\r\n    // delete() {\r\n    //     return this.dbClient.deleteTable({\r\n    //         TableName: this.name\r\n    //     }).promise();\r\n    // }\r\n\r\n    // describe() {\r\n    //     return this.dbClient.describeTable({\r\n    //         TableName: this.name\r\n    //     }).promise();\r\n    // }\r\n\r\n    async exists() {\r\n        const path = '/db/tables';\r\n        const url = BaseURL + path;\r\n        let request = {\r\n            method: METHODS.GET,\r\n            headers: AppJSONHeaders(),\r\n        } as any;\r\n        const resp = await this.fetchJSON(url, request);\r\n        return (resp.TableNames as string[]).indexOf(TableName as string) !== -1;\r\n    }\r\n\r\n    //// Item operations:\r\n\r\n    async put(item: IEntity) {\r\n        const path = '/db/table';\r\n        const url = BaseURL + path;\r\n        let request = {\r\n            method: METHODS.POST,\r\n            headers: AppJSONHeaders(),\r\n            body: JSON.stringify({\r\n                TableName: this.getName(),\r\n                Item: item.toDBForm()\r\n            })\r\n        };\r\n        return this.fetchJSON(url, request);\r\n    }\r\n\r\n    async update(pk: string, sk: string, entity: IEntity) {\r\n        const deleted = await this.delete(pk, sk);\r\n        console.log(deleted);\r\n        const puted = await this.put(entity);\r\n        console.log(puted);\r\n    }\r\n\r\n    async get(pk: string, sk: string) {\r\n        const path = '/db/table/get-item';\r\n        const url = BaseURL + path;\r\n        const key = this.getKey(pk, sk);\r\n        const request = {\r\n            method: METHODS.POST,\r\n            headers: AppJSONHeaders(),\r\n            body: JSON.stringify({\r\n                TableName: this.getName(),\r\n                Key: DynamoDB.Converter.marshall(key)\r\n            })\r\n        };\r\n        const item = DynamoDB.Converter.unmarshall((await this.fetchJSON(url, request))['Item']);\r\n        if (item === undefined) {\r\n            return item;\r\n        }\r\n        const ctor = this.getEntityConstructor(PrimaryKey.getPrefixFromPK(item[this.pkName]), SortKey.getPrefixFromSK(item[this.skName]));\r\n        return new (ctor as any)(item);\r\n    }\r\n\r\n    async delete(pk: string, sk: string) {\r\n        const path = '/db/table';\r\n        const url = BaseURL + path;\r\n        const key = this.getKey(pk, sk);\r\n        const request = {\r\n            method: METHODS.DELETE,\r\n            headers: AppJSONHeaders(),\r\n            body: JSON.stringify({\r\n                TableName: this.getName(),\r\n                Key: DynamoDB.Converter.marshall(key)\r\n            })\r\n        };\r\n        console.log(await this.fetchJSON(url, request));\r\n        // const item = DynamoDB.Converter.unmarshall((await this.fetchJSON(url, request))['Item']);\r\n    }\r\n\r\n    async query(keyConditionExpression: string, expressionAttributeValues: {[key: string]: any}): Promise<{[p: string]: any}[]> {\r\n        const path = '/db/table/query';\r\n        const url = BaseURL + path;\r\n        let request = {\r\n            method: METHODS.POST,\r\n            headers: AppJSONHeaders(),\r\n            body: JSON.stringify({\r\n                TableName: this.getName(),\r\n                KeyConditionExpression: keyConditionExpression,\r\n                ExpressionAttributeValues: DynamoDB.Converter.marshall(expressionAttributeValues)\r\n            })\r\n        };\r\n        return (await this.fetchJSON(url, request))['Items'].map((item: DynamoDB.AttributeMap) => DynamoDB.Converter.unmarshall(item));\r\n    }\r\n\r\n}\r\n\r\nexport class ClassTable extends Table {\r\n\r\n    public static readonly Name = TableName as string;\r\n    public static readonly PKName = 'PKMeta';\r\n    public static readonly SKName = 'SKMeta';\r\n\r\n    constructor(fetchClient: AwsClient) {\r\n        super(fetchClient, ClassTable.Name, ClassTable.PKName, ClassTable.SKName);\r\n        this.addEntity(HIT)\r\n            .addEntity(ProjectDescription);\r\n        // this.getProjectNames().then(console.log).catch(console.log)\r\n    }\r\n\r\n    async deleteEntity(entity: ClassTableEntity) {\r\n        return this.delete(entity.PKMeta, entity.SKMeta);\r\n    }\r\n\r\n    async getEntity(entity: ClassTableEntity) {\r\n        return this.get(entity.PKMeta, entity.SKMeta);\r\n    }\r\n\r\n    async getProjectNames() {\r\n        return (await this.query(\r\n            'PKMeta = :pk AND begins_with(SKMeta, :skp)',\r\n            {\r\n                ':pk': ProjectDescription.PK,\r\n                ':skp': '#' + ProjectDescription.sortKeyPrefix\r\n            }))\r\n            .map(item => new ProjectDescription(item));\r\n    }\r\n\r\n    async incrementHITCount(wustlKey: string, sortKeyData: HITSortKeyData) {\r\n        // const key = this.getKey(wustlKey, HIT.sortKey.toString(sortKeyData));\r\n        // const ret = await this.docClient.update({\r\n        //     TableName: this.getName(),\r\n        //     Key: key,\r\n        //     ExpressionAttributeValues: {':c': 1},\r\n        //     UpdateExpression: 'ADD Cnt :c',\r\n        //     ReturnValues: 'ALL_OLD'\r\n        // }).promise();\r\n        // return (this.getEntityConstructor(HIT.sortKeyPrefix))(ret.)\r\n        // return ret;\r\n    }\r\n\r\n}\r\n\r\ntype HITSortKeyData = {\r\n    ProjectName: string,\r\n    Iteration: number,\r\n    HITName: string\r\n}\r\n\r\nabstract class ClassTableEntity extends AEntity {\r\n    // @ts-ignore\r\n    PKMeta: string;      // Partition Key\r\n    // @ts-ignore\r\n    SKMeta: string;      // Sort Key\r\n\r\n}\r\n\r\nexport class Task {\r\n    tag: string;\r\n    description: string;\r\n\r\n    constructor(tag: string, description: string) {\r\n        this.tag = tag;\r\n        this.description = description;\r\n    }\r\n}\r\n\r\nexport class ProjectDescription extends ClassTableEntity {\r\n\r\n    static ProjectName = 'ProjectName';\r\n    static primaryKeyPrefix = 'CLASS';\r\n    static sortKeyPrefix = 'PROJECT_NAME';\r\n    static PK = '#' + ProjectDescription.primaryKeyPrefix + ':' + ProjectDescription.ProjectName;\r\n    public static readonly primaryKey = new PrimaryKey(ClassTable.PKName, ProjectDescription.primaryKeyPrefix, ProjectDescription.ProjectName, Types.Str);\r\n    public static readonly sortKey = new SortKey(ClassTable.SKName, ProjectDescription.sortKeyPrefix, ['Name'], [Types.Str]);\r\n\r\n    // @ts-ignore\r\n    ProjectName: string;\r\n    // @ts-ignore\r\n    Name: string;\r\n    // @ts-ignore\r\n    Tasks: string;\r\n    parsedTags: Task[];\r\n\r\n    constructor(data: DynamoDB.DocumentClient.AttributeMap) {\r\n        data['ProjectName'] = ProjectDescription.ProjectName;\r\n        super();\r\n        this.construct(data);\r\n        // @ts-ignore\r\n        if (this.Tasks === undefined) {\r\n            this.parsedTags = [];\r\n        } else {\r\n            this.parsedTags = JSON.parse(this.Tasks).map((task: any) => new Task(task.tag, task.description));\r\n        }\r\n    }\r\n\r\n    primaryKey(): PrimaryKey {\r\n        return ProjectDescription.primaryKey;\r\n    }\r\n\r\n    sortKey(): SortKey {\r\n        return ProjectDescription.sortKey;\r\n    }\r\n\r\n    get sortKeyPrefix(): string {\r\n        return ProjectDescription.sortKeyPrefix;\r\n    }\r\n\r\n    public static Create(name: string, tasks: string) {\r\n        if (tasks === '') {\r\n            tasks = '[]';\r\n        }\r\n        return new ProjectDescription({\r\n            PKMeta: ProjectDescription.PK,\r\n            SKMeta: this.sortKey.toString({Name: name}),\r\n            Tasks: tasks\r\n        });\r\n    }\r\n\r\n}\r\n\r\nexport class HIT extends ClassTableEntity {\r\n\r\n    static primaryKeyPrefix = 'STUDENT';\r\n    static sortKeyPrefix = 'HIT';\r\n    public static readonly primaryKey = new PrimaryKey(ClassTable.PKName, HIT.primaryKeyPrefix, 'WUSTLKey', Types.Str);\r\n    public static readonly sortKey = new SortKey(ClassTable.SKName, HIT.sortKeyPrefix, ['ProjectName', 'Iteration', 'HITName'], [Types.Str, Types.Num, Types.Str]);\r\n\r\n    // @ts-ignore\r\n    WUSTLKey: string;    // WUSTLKey\r\n    // @ts-ignore\r\n    ProjectName: string; // ProjectName\r\n    // @ts-ignore\r\n    Iteration: number;   // Iteration\r\n    // @ts-ignore\r\n    HITName: string;     // HITName\r\n    // @ts-ignore\r\n    Cnt: number;         // Cnt (short for Count or Counter which are both reserved keywords)\r\n    // @ts-ignore\r\n    AWSIDs: string[];    // AWSIDs\r\n\r\n    constructor(data: DynamoDB.DocumentClient.AttributeMap) {\r\n        super();\r\n        this.construct(data);\r\n    }\r\n\r\n    primaryKey(): PrimaryKey {\r\n        return HIT.primaryKey;\r\n    }\r\n\r\n    sortKey(): SortKey {\r\n        return HIT.sortKey;\r\n    }\r\n\r\n    get sortKeyPrefix(): string {\r\n        return HIT.sortKeyPrefix;\r\n    }\r\n\r\n    public static Create(wustlKey: string, projectName: string, iteration: number, hitName: string, cnt: number, awsIDs: string[]) {\r\n        return new HIT({\r\n            PKMeta: this.primaryKey.toString(wustlKey),\r\n            SKMeta: this.sortKey.toString({ProjectName: projectName, Iteration: iteration, HITName: hitName}),\r\n            Cnt: cnt,\r\n            AWSIDs: awsIDs\r\n        });\r\n    }\r\n\r\n}\r\n\r\nexport class Log extends ClassTableEntity {\r\n\r\n    static primaryKeyPrefix = 'STUDENT';\r\n    static sortKeyPrefix = 'LOG';\r\n    public static readonly  primaryKey = new PrimaryKey(ClassTable.PKName, Log.primaryKeyPrefix, 'HITID', Types.Str);\r\n    public static readonly sortKey = new SortKey(ClassTable.SKName, Log.sortKeyPrefix, ['AssignmentID', 'WorkerID'], [Types.Str, Types.Str]);\r\n\r\n    // @ts-ignore\r\n    HITID: string;\r\n    // @ts-ignore\r\n    AssignmentID: string;\r\n    // @ts-ignore\r\n    WorkerID: string;\r\n\r\n    constructor(data: DynamoDB.DocumentClient.AttributeMap) {\r\n        super();\r\n        this.construct(data);\r\n    }\r\n\r\n    primaryKey(): PrimaryKey {\r\n        return Log.primaryKey;\r\n    }\r\n\r\n    sortKey(): SortKey {\r\n        return Log.sortKey;\r\n    }\r\n\r\n    get sortKeyPrefix(): string {\r\n        return Log.sortKeyPrefix;\r\n    }\r\n\r\n    public static Create(hitID: string, assignmentID: string, workerID: string) {\r\n        return new Log({\r\n            PKMeta: this.primaryKey.toString(hitID),\r\n            SKMeta: this.sortKey.toString({AssignmentID: assignmentID, WorkerID: workerID}),\r\n        });\r\n    }\r\n\r\n}\r\n","import {table, ClassTable, ProjectDescription, Task} from \"../aws/db\";\r\nimport MTPool, {TAccountBalances} from \"../aws/mturk\";\r\nimport {store} from \"./store\";\r\nimport {Parser} from \"papaparse\";\r\n\r\nexport enum EDBStatus {\r\n    Unknown,\r\n    Created,\r\n    DoesNotExist,\r\n}\r\n\r\n// action types\r\nexport const LOGIN = 'LOGIN';\r\nexport const LOGOUT = 'LOGOUT';\r\nexport const UPDATE_DB_STATUS = 'UPDATE_DB_STATUS';\r\nexport const UPDATE_PROJECTS = 'UPDATE_PROJECTS';\r\nexport const UPDATE_ITERATIONS = 'UPDATE_ITERATIONS';\r\nexport const UPDATE_CURRENT_PROJECT = 'UPDATE_CURRENT_PROJECT';\r\nexport const UPDATE_CURRENT_ITERATION = 'UPDATE_CURRENT_ITERATION';\r\nexport const UPDATE_SPI_DATA = 'UPDATE_SPI_DATA';\r\nexport const UPDATE_STUDENTS = 'UPDATE_STUDENTS';\r\nexport const UPDATE_BALANCES = 'UPDATE_BALANCES';\r\nexport const UPDATE_SUBMIT_HIT_DATA = 'UPDATE_SUBMIT_HIT_DATA';\r\nexport const UPDATE_MTURK_MODE = 'UPDATE_MTURK_MODE';\r\n\r\nexport enum SubmitHITDataType {\r\n    COUNT_GIVEN,\r\n    COUNT_NOT_GIVEN,\r\n}\r\n\r\nexport class Data {\r\n    header: string[];\r\n    values: string[][];\r\n\r\n    constructor(header: string[], values: string[][]) {\r\n        this.header = header;\r\n        this.values = values;\r\n    }\r\n\r\n    indexOfHeader(key: string) {\r\n        return this.header.indexOf(key);\r\n    }\r\n\r\n    findFirstEntry(query: {index: number, expectedValue: string}[]) {\r\n        const ret = this.values.find(row => {\r\n            return query.every(queryTerm => {\r\n                if (row[queryTerm.index] === queryTerm.expectedValue) {\r\n                    return true;\r\n                }\r\n                return false;\r\n            });\r\n        });\r\n        return ret;\r\n    }\r\n\r\n    resetValues() {\r\n        this.values = [];\r\n        return this;\r\n    }\r\n}\r\n\r\nexport interface SubmitHITData {\r\n    dataType: SubmitHITDataType,\r\n    data: Data,\r\n}\r\n\r\nexport interface StudentProjectIterationTask {\r\n    name: string;\r\n    count: number;\r\n}\r\n\r\nexport interface StudentProjectIteration {\r\n    tasks: StudentProjectIterationTask[];\r\n}\r\n\r\nexport interface SPIData {\r\n    [wustlKey: string]: {\r\n        [projectName: string]: StudentProjectIteration[]\r\n    };\r\n}\r\n\r\nexport interface Student {\r\n    url: string;\r\n    wustlKey: string;\r\n    id: string;\r\n    secret: string;\r\n}\r\n\r\nexport enum LoginStatus {\r\n    UNATTEMPTED,\r\n    FAILED,\r\n    SUCCEEDED\r\n}\r\n\r\nexport interface Tasks {\r\n    [projectName: string]: Task[]\r\n}\r\n\r\nexport enum MTurkMode {\r\n    SANDBOX,\r\n    REAL\r\n}\r\n\r\nexport interface RootState {\r\n    loggedIn: LoginStatus;\r\n    dbStatus: EDBStatus;\r\n    projects: ProjectDescription[];\r\n    iterations: number;\r\n    currentProject: ProjectDescription;\r\n    currentIteration: number;\r\n    spiData: null | SPIData;\r\n    students: Student[];\r\n    accountBalances: TAccountBalances;\r\n    submitHITData: SubmitHITData,\r\n    mturkMode: MTurkMode;\r\n}\r\n\r\nexport const login = () => {\r\n    return {\r\n        type: LOGIN,\r\n        loggedIn: LoginStatus.SUCCEEDED\r\n    };\r\n}\r\n\r\nexport const logout = () => {\r\n    return {\r\n        type: LOGOUT,\r\n        loggedIn: LoginStatus.FAILED\r\n    };\r\n}\r\n\r\nexport const updateDBStatus = (dbStatus: EDBStatus) => {\r\n    return {\r\n        type: UPDATE_DB_STATUS,\r\n        dbStatus\r\n    };\r\n}\r\n\r\nexport const updateProjects = (projects: ProjectDescription[]) => {\r\n    const sortedProjects = projects.sort((a, b) => a.Name < b.Name ? -1 : 1);\r\n    return {\r\n        type: UPDATE_PROJECTS,\r\n        projects: sortedProjects,\r\n        currentProject: sortedProjects[0] ? sortedProjects[0] : ProjectDescription.Create('No Projects Yet', '')\r\n    }\r\n}\r\n\r\nexport const updateIterations = (iterations: number) => {\r\n    return {\r\n        type: UPDATE_ITERATIONS,\r\n        iterations,\r\n        iteration: 0\r\n    }\r\n}\r\n\r\nexport const updateCurrentProject = (currentProject: ProjectDescription) => {\r\n    return {\r\n        type: UPDATE_CURRENT_PROJECT,\r\n        currentProject\r\n    };\r\n}\r\n\r\nexport const updateCurrentIteration = (currentIteration: number) => {\r\n    return {\r\n        type: UPDATE_CURRENT_ITERATION,\r\n        currentIteration\r\n    };\r\n}\r\n\r\nexport const updateSPIData = (spiData: SPIData) => {\r\n    return {\r\n        type: UPDATE_SPI_DATA,\r\n        spiData\r\n    }\r\n}\r\n\r\nexport const updateStudents = (students: Student[]) => {\r\n    students.forEach(stud => {\r\n        MTPool.add(stud.wustlKey, stud.id, stud.secret);\r\n    });\r\n    return {\r\n        type: UPDATE_STUDENTS,\r\n        students\r\n    }\r\n}\r\n\r\nexport const updateBalances = (accountBalances: TAccountBalances) => {\r\n    return {\r\n        type: UPDATE_BALANCES,\r\n        accountBalances\r\n    };\r\n}\r\n\r\nexport const updateSubmitHITData = (submitHITData: SubmitHITData) => {\r\n    return {\r\n        type: UPDATE_SUBMIT_HIT_DATA,\r\n        submitHITData\r\n    }\r\n}\r\n\r\nexport const updateMTurkMode = (mturkMode: MTurkMode) => {\r\n    return {\r\n        type: UPDATE_MTURK_MODE,\r\n        mturkMode\r\n    }\r\n}\r\n\r\nexport const fetchProjects = () => {\r\n    return async (dispatch: any) => {\r\n        try {\r\n            const projects = (await (table as ClassTable).getProjectNames());\r\n            console.log(projects)\r\n            dispatch(updateProjects(projects));\r\n        } catch (e) {console.log(e);}\r\n    }\r\n}\r\n\r\nexport const fetchSPIData = () => {\r\n    return async (dispatch: any) => {\r\n        try {\r\n            dispatch(updateSPIData({}));\r\n        } catch (e) {console.log(e);}\r\n    }\r\n}\r\n\r\nexport const fetchAccountBalances = (sandbox: MTurkMode) => {\r\n    return async(dispatch: any) => {\r\n        try {\r\n            const balances = await Promise.all(await MTPool.getAccountBalances(sandbox));\r\n            console.log(balances)\r\n            dispatch(updateBalances(balances));\r\n        } catch (e) {console.log(e);}\r\n    }\r\n}\r\n","import AWS, {AWSError} from 'aws-sdk';\r\nimport {GetAccountBalanceResponse} from \"aws-sdk/clients/mturk\";\r\nimport {Region} from \"./aws-constants\";\r\nimport {Data, MTurkMode} from \"../redux/actions\";\r\n\r\ntype MTurkAccounts = { [wustlKey: string]: AWS.MTurk };\r\nexport type AccountPair = {wustlKey: string, balance: string};\r\nexport type TAccountBalances = AccountPair[];\r\n\r\ntype AWSTableError = {\r\n    wustlKey: string,\r\n    error: string,\r\n    code: string,\r\n    message: string,\r\n};\r\nclass MTurkPool {\r\n    private accts: MTurkAccounts = {};\r\n    private sandboxAccts: MTurkAccounts = {};\r\n    private realAccts: MTurkAccounts = {};\r\n    private static HitConfig(url: string): string {\r\n        return `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n                    <ExternalQuestion xmlns=\"http://mechanicalturk.amazonaws.com/AWSMechanicalTurkDataSchemas/2006-07-14/ExternalQuestion.xsd\">\r\n                        <ExternalURL>${url}</ExternalURL>\r\n                        <FrameHeight>0</FrameHeight>\r\n                    </ExternalQuestion>`;\r\n    }\r\n\r\n    add(wustlKey: string, accessID: string, accessSecret: string) {\r\n        this.addRealAccount(wustlKey, new AWS.MTurk({\r\n            region: Region,\r\n            endpoint: 'https://mturk-requester.us-east-1.amazonaws.com',\r\n            credentials: {\r\n                accessKeyId: accessID,\r\n                secretAccessKey: accessSecret\r\n            }\r\n        }));\r\n        this.addSandboxAccount(wustlKey, new AWS.MTurk({\r\n            region: Region,\r\n            endpoint: 'https://mturk-requester-sandbox.us-east-1.amazonaws.com',\r\n            credentials: {\r\n                accessKeyId: accessID,\r\n                secretAccessKey: accessSecret\r\n            }\r\n        }));\r\n    }\r\n\r\n    addRealAccount(wustlKey: string, acct: AWS.MTurk) {\r\n        this.realAccts[wustlKey] = acct;\r\n    }\r\n\r\n    addSandboxAccount(wustlKey: string, acct: AWS.MTurk) {\r\n        this.sandboxAccts[wustlKey] = acct;\r\n    }\r\n\r\n    private setSandbox(sandbox: MTurkMode) {\r\n        if (sandbox === MTurkMode.SANDBOX) {\r\n            this.accts = this.sandboxAccts;\r\n        } else {\r\n            this.accts = this.realAccts;\r\n        }\r\n    }\r\n\r\n    private forp<E>(fun: (wustlKey: string, acct: AWS.MTurk) => E): E[] {\r\n        return Object.keys(this.accts).map(key => {\r\n            return fun(key, this.accts[key]);\r\n        });\r\n    }\r\n\r\n    async getAccountBalance(wustlKey: string, acct: AWS.MTurk) {\r\n        return new Promise<AccountPair>((resolve, reject) => {\r\n            acct.getAccountBalance((err: AWSError, data: GetAccountBalanceResponse) => {\r\n                if (err) {\r\n                    resolve({wustlKey: wustlKey, balance: \"Not Available.\"});\r\n                } else {\r\n                    resolve({wustlKey: wustlKey, balance: data.AvailableBalance ? data.AvailableBalance : \"Not Available.\"});\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    async getAccountBalances(sandbox: MTurkMode) {\r\n        this.setSandbox(sandbox);\r\n        return this.forp(async (wustlKey, acct) => {\r\n            return this.getAccountBalance(wustlKey, acct);\r\n        });\r\n    }\r\n\r\n    async uploadHit() {\r\n\r\n    }\r\n\r\n    async uploadHits(urls: {[wustlKey: string]: {count: number, url: string, price: string}[]}, sandbox: MTurkMode) {\r\n        this.setSandbox(sandbox);\r\n        return this.forp(async (wustlKey, acct) => {\r\n            return new Promise<AccountPair | AWSTableError>((resolve, reject) => {\r\n                const urlsForStud = urls[wustlKey];\r\n                if (urlsForStud) {\r\n                    urlsForStud.forEach(async urlCountPair => {\r\n                        // console.log(wustlKey + ' ' + urlCountPair.url + ' ' + urlCountPair.count);\r\n                        if (urlCountPair.count > 0) {\r\n                            setTimeout(async () => {\r\n                                acct.createHIT({ // TODO: fix this to be generalizable config\r\n                                        AssignmentDurationInSeconds: 360,\r\n                                        AutoApprovalDelayInSeconds: 2592000,\r\n                                        Description: 'You will be given a scenario for a website user. Please navigate through the website to find the answer - your path is tracked as you work. When you are on the page with the answer, fill out the text box in the drop down at the top of the page and click submit. Correct answers will receive bonuses of up to $.25.',\r\n                                        LifetimeInSeconds: (60 * 60 * 20), // 20 hours\r\n                                        MaxAssignments: urlCountPair.count,\r\n                                        Reward: urlCountPair.price,\r\n                                        Title: \"Information Foraging WUSTL\",\r\n                                        Question: MTurkPool.HitConfig(urlCountPair.url)\r\n                                    },\r\n                                    async (err, data) => {\r\n                                        if (err) {\r\n                                            console.log(\"ERROR: \" + err);\r\n                                            resolve({\r\n                                                wustlKey: wustlKey,\r\n                                                error: err.name,\r\n                                                code: err.code,\r\n                                                message: err.message\r\n                                            });\r\n                                        } else {\r\n                                            console.log(\"DATA: \" + data);\r\n                                            resolve({\r\n                                                wustlKey: wustlKey,\r\n                                                balance: (await acct.getAccountBalance().promise()).AvailableBalance as string,\r\n                                            });\r\n                                        }\r\n                                    });\r\n                            },100);\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    async cancelHits() {\r\n        return this.forp(async (wustlKey, acct) => {\r\n            return new Promise<AccountPair>(async (resolve, reject) => {\r\n                const hits = await acct.listHITs().promise();\r\n                hits.HITs?.forEach(hit => {\r\n                    setTimeout(() => {\r\n                        acct.updateExpirationForHIT({\r\n                            ExpireAt: new Date(),\r\n                            HITId: hit.HITId as string\r\n                        }, (err, data) => {\r\n                            if (err) {\r\n                                console.log(\"ERROR: \" + err);\r\n                            } else {\r\n                                console.log(\"DATA: \" + data);\r\n                            }\r\n                        });\r\n                    },100);\r\n                });\r\n            });\r\n        });\r\n    }\r\n\r\n    async payHits(data: Data) {\r\n        for (let i = 0; i < data.values.length; i++) {\r\n            const row = data.values[i];\r\n            const acct = this.accts[row[0]];\r\n            let resp;\r\n            try {\r\n                if (acct != undefined) {\r\n                    switch (row[3]) {\r\n                        case 'approve':\r\n                            resp = await acct.approveAssignment({\r\n                                AssignmentId: row[2],\r\n                            }).promise();\r\n                            console.log(resp.$response);\r\n                            break;\r\n                        case 'reject':\r\n                            resp = await acct.rejectAssignment({\r\n                                AssignmentId: row[2],\r\n                                RequesterFeedback: 'The log of your actions on the website and the written response did not show substantial effort in completing this task and therefore do not warrant payment.'\r\n                            }).promise();\r\n                            console.log(resp.$response);\r\n                            break;\r\n                        case 'bonus':\r\n                            resp = await acct.approveAssignment({\r\n                                AssignmentId: row[2],\r\n                            }).promise();\r\n                            console.log(resp.$response);\r\n                            resp = await acct.sendBonus({\r\n                                AssignmentId: row[2],\r\n                                WorkerId: row[1],\r\n                                BonusAmount: '0.10',\r\n                                Reason: 'Your work showed an honest effort to complete the task and you either found the correct answer or put in strong logical thought in your actions. Thank your for your time, and we hope this bonus makes the HIT feel more worthwhile.',\r\n                                UniqueRequestToken: ''\r\n                            }).promise();\r\n                            console.log(resp.$response);\r\n                            break;\r\n                        default:\r\n                            console.log(row);\r\n                            console.log('^^ the above row did not contain a valid action ^^');\r\n                            break;\r\n                    }\r\n                } else {\r\n                    console.log(row);\r\n                    console.log('^^ row was undefined ^^');\r\n                }\r\n            } catch (e) {\r\n                console.log(e);\r\n            }\r\n        }\r\n    }\r\n\r\n    async getStatuses(sandbox: MTurkMode) {\r\n        this.setSandbox(sandbox);\r\n        let data = new Data(['WUSTL Key', 'Awaiting Acceptance', 'In Progress', 'Completed'], []);\r\n        let promises = this.forp(async (key: string, acct: AWS.MTurk) => {\r\n            let entry = [key, 0, 0, 0];\r\n            const hits = (await acct.listHITs().promise()).HITs;\r\n            if (hits && hits.length > 0) {\r\n                const as = hits.map(hit => hit.MaxAssignments ? hit.MaxAssignments : 0).reduce((prev: number, cur: number) => prev + cur, 0);\r\n                hits.forEach(hit => {\r\n                    const available = hit.NumberOfAssignmentsAvailable ? hit.NumberOfAssignmentsAvailable : 0;\r\n                    const pending = hit.NumberOfAssignmentsPending ? hit.NumberOfAssignmentsPending : 0;\r\n                    let completed = hit.MaxAssignments ? hit.MaxAssignments : 0;\r\n                    completed -= (available + pending);\r\n                    completed = Math.max(completed, 0);\r\n                    switch (hit.HITStatus) {\r\n                        case \"Assignable\":\r\n                            (entry[1] as number) += available;\r\n                            break;\r\n                        case \"Unassignable\":\r\n                            (entry[2] as number) += pending;\r\n                            break;\r\n                        case \"Reviewable\":\r\n                            (entry[3] as number) += completed;\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                });\r\n            }\r\n            let sEntry = entry.map(item => item + '');\r\n            data.values.push(sEntry);\r\n            return true;\r\n        });\r\n        if (promises) {\r\n            for (let promise of promises) {\r\n                await promise;\r\n            }\r\n        }\r\n        return data;\r\n    }\r\n}\r\n\r\nconst MTPool = new MTurkPool();\r\n\r\nexport default MTPool;\r\n","import React from \"react\";\r\nimport {connect, ConnectedProps} from 'react-redux'\r\nimport {EDBStatus, RootState, updateDBStatus} from \"../redux/actions\";\r\nimport {table} from \"../aws/db\";\r\n\r\nconst mapState = (state: RootState) => {\r\n    return {\r\n        dbStatus: state.dbStatus\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    updateDBStatus\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatchToProps);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>;\r\n\r\ntype Props = PropsFromRedux & {};\r\n\r\nclass DBStatus extends React.Component<Props, {}> {\r\n\r\n    renderCheck() {\r\n        return (\r\n          <button className={\"status-update safe right\"} onClick={async () => {\r\n              this.props.updateDBStatus((await table?.exists) ? EDBStatus.Created : EDBStatus.DoesNotExist);\r\n          }}>\r\n              Check\r\n          </button>\r\n        );\r\n    }\r\n\r\n    status() {\r\n        switch (this.props.dbStatus) {\r\n            case EDBStatus.Unknown:\r\n                return 'The status is currently unknown. Would you like to check?';\r\n            case EDBStatus.Created:\r\n                return 'The database is created and awaiting requests.';\r\n            case EDBStatus.DoesNotExist:\r\n                return 'The database does not exist. You should initialize it if you would like to use it.';\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className={\"status-container\"}>\r\n                {this.renderCheck()}\r\n                <h2>\r\n                    Database Status:\r\n                </h2>\r\n                <p className={\"status\"}>\r\n                    {this.status()}\r\n                </p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n}\r\n\r\nexport default connector(DBStatus);","import React from \"react\";\r\nimport {RootState, updateCurrentIteration, updateCurrentProject} from \"../redux/actions\";\r\nimport {connect, ConnectedProps} from \"react-redux\";\r\nimport {ProjectDescription} from \"../aws/db\";\r\n\r\nexport const mapState = (state: RootState) => {\r\n    return {\r\n        projects: state.projects,\r\n        iterations: state.iterations,\r\n        currentProject: state.currentProject,\r\n        currentIteration: state.currentIteration\r\n    };\r\n};\r\n\r\nexport const mapDispatchToProps = {\r\n    updateCurrentProject,\r\n    updateCurrentIteration\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatchToProps);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>;\r\n\r\ntype Props = PropsFromRedux & {};\r\n\r\ntype State = {\r\n}\r\n\r\nconst ffor = (num: number, fun: (num: number) => any) => {\r\n    let ret = [];\r\n    for (let i = 0; i < num; i++) {\r\n        ret.push(fun(i));\r\n    }\r\n    return ret;\r\n};\r\n\r\nclass ProjectIterationSelector extends React.Component<Props, State> {\r\n\r\n    render() {\r\n        return (\r\n            <div className={'project-iteration-selector'}>\r\n                <div className={'project-iteration-description'}>\r\n                    Project Name: Iteration\r\n                </div>\r\n                <div>\r\n                    <select className={'project-selector'} onChange={ev => this.props.updateCurrentProject(this.props.projects[ev.target.selectedIndex])}>\r\n                        {\r\n                            this.props.projects.map((project, index) => {\r\n                                return (\r\n                                    <option key={project.Name} value={project.Name}>\r\n                                        {project.Name}\r\n                                    </option>\r\n                                );\r\n                            })\r\n                        }\r\n                    </select>\r\n                    <span className={'separator'}>:</span>\r\n                    <select className={'iteration-selector'} onChange={ev => this.props.updateCurrentIteration(parseInt(ev.target.value))}>\r\n                        {\r\n                            ffor(this.props.iterations, (iteration => {\r\n                                return (\r\n                                    <option key={iteration} value={iteration}>\r\n                                        {iteration + 1}\r\n                                    </option>\r\n                                );\r\n                            }))\r\n                        }\r\n                    </select>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connector(ProjectIterationSelector);","import {\r\n    Data,\r\n    EDBStatus,\r\n    LOGIN,\r\n    LoginStatus,\r\n    LOGOUT,\r\n    MTurkMode,\r\n    RootState,\r\n    SPIData,\r\n    Student, SubmitHITData,\r\n    SubmitHITDataType,\r\n    UPDATE_BALANCES,\r\n    UPDATE_CURRENT_ITERATION,\r\n    UPDATE_CURRENT_PROJECT,\r\n    UPDATE_DB_STATUS,\r\n    UPDATE_ITERATIONS,\r\n    UPDATE_MTURK_MODE,\r\n    UPDATE_PROJECTS,\r\n    UPDATE_SPI_DATA,\r\n    UPDATE_STUDENTS, UPDATE_SUBMIT_HIT_DATA\r\n} from \"./actions\";\r\nimport {ProjectDescription} from \"../aws/db\";\r\nimport {TAccountBalances} from \"../aws/mturk\";\r\n\r\n// const defaultState: RootState = {\r\n//     loggedIn: false,\r\n//     dbStatus: EDBStatus.Unknown,\r\n//     projects: ['project 1', 'project 2', 'project 3'],\r\n//     iterations: 3,\r\n//     currentProject: 'project 1',\r\n//     currentIteration: 0,\r\n//     spiData: {'riley.mccuen': {project1: [{name1: 'math', name2: 'birthdays', name3: 'treats', count1: 2, count2: 2, count3: 3}]}},\r\n//     students: [{wustlKey: 'riley.mccuen', id: '', secret: ''}]\r\n// };\r\n\r\nconst defaultState: RootState = {\r\n    loggedIn: LoginStatus.UNATTEMPTED,\r\n    dbStatus: EDBStatus.Unknown,\r\n    projects: [],\r\n    iterations: 3,\r\n    currentProject: ProjectDescription.Create('', ''),\r\n    currentIteration: 0,\r\n    spiData: null,\r\n    students: [],\r\n    accountBalances: [],\r\n    submitHITData: {dataType: SubmitHITDataType.COUNT_NOT_GIVEN, data: new Data([], [])},\r\n    mturkMode: MTurkMode.SANDBOX,\r\n};\r\n\r\nexport function rootReducer(state=defaultState, action: any){\r\n    const reducerHelper = (updates: object) => {\r\n        return Object.assign({}, state, updates);\r\n    };\r\n    switch(action.type) {\r\n        case LOGIN:\r\n            const lin = action as {loggedIn: LoginStatus};\r\n            return reducerHelper({\r\n                loggedIn: lin.loggedIn\r\n            });\r\n        case LOGOUT:\r\n            const lout = action as {loggedIn: LoginStatus};\r\n            return reducerHelper({\r\n                loggedIn: lout.loggedIn\r\n            });\r\n        case UPDATE_DB_STATUS:\r\n            const udbs = action as {dbStatus: EDBStatus};\r\n            return reducerHelper({\r\n                dbStatus: udbs.dbStatus\r\n            });\r\n        case UPDATE_PROJECTS:\r\n            const up = action as {projects: string[], currentProject: string};\r\n            return reducerHelper({\r\n                projects: up.projects,\r\n                currentProject: up.currentProject\r\n            });\r\n        case UPDATE_ITERATIONS:\r\n            const ui = action as {iterations: number, iteration: number};\r\n            return reducerHelper({\r\n                iterations: ui.iterations,\r\n                currentIteration: ui.iteration\r\n            });\r\n        case UPDATE_CURRENT_PROJECT:\r\n            const ucp = action as {currentProject: string};\r\n            return reducerHelper({\r\n                currentProject: ucp.currentProject\r\n            });\r\n        case UPDATE_CURRENT_ITERATION:\r\n            const uci = action as {currentIteration: number};\r\n            return reducerHelper({\r\n                currentIteration: uci.currentIteration\r\n            });\r\n        case UPDATE_SPI_DATA:\r\n            const uspid = action as {spiData: SPIData};\r\n            return reducerHelper({\r\n                spiData: uspid.spiData\r\n            });\r\n        case UPDATE_STUDENTS:\r\n            const us = action as {students: Student[]};\r\n            return reducerHelper({\r\n                students: us.students\r\n            });\r\n        case UPDATE_BALANCES:\r\n            const ub = action as {accountBalances: TAccountBalances};\r\n            return reducerHelper({\r\n                accountBalances: ub.accountBalances,\r\n            });\r\n        case UPDATE_SUBMIT_HIT_DATA:\r\n            const ushd = action as {submitHITData: SubmitHITData};\r\n            console.log(ushd)\r\n            return reducerHelper({\r\n                submitHITData: ushd.submitHITData,\r\n            });\r\n        case UPDATE_MTURK_MODE:\r\n            const umm = action as {mturkMode: MTurkMode};\r\n            return reducerHelper({\r\n                mturkMode: umm.mturkMode\r\n            });\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\n","import {applyMiddleware, compose, createStore} from \"redux\";\r\nimport {rootReducer} from \"./reducers\";\r\nimport thunk from \"redux-thunk\";\r\n\r\nexport const store = createStore(rootReducer, compose(\r\n    applyMiddleware(thunk)\r\n));","import React from \"react\";\r\nimport {connect, ConnectedProps} from 'react-redux'\r\nimport {RootState, updateProjects} from \"../redux/actions\";\r\nimport {store} from \"../redux/store\";\r\nimport {ProjectDescription, table, Task} from \"../aws/db\";\r\nimport {FileDrop} from \"react-file-drop\";\r\n\r\nconst mapState = (state: RootState) => {\r\n    return {\r\n        projects: state.projects\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    updateProjects\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatchToProps);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>;\r\n\r\ntype Props = PropsFromRedux & {};\r\n\r\ntype UpdateProjectProps = {\r\n    project: ProjectDescription,\r\n    selected: boolean,\r\n    delete: () => any,\r\n    update: (newVal: ProjectDescription) => any,\r\n    select: (callback: () => any) => any\r\n}\r\n\r\nclass UpdateProject extends React.Component<UpdateProjectProps, { editing: boolean, val: string, selected: boolean }> {\r\n\r\n    private inputElem = React.createRef<HTMLInputElement>();\r\n    private tagInputElem = React.createRef<HTMLInputElement>();\r\n\r\n    constructor(props: UpdateProjectProps) {\r\n        super(props);\r\n        this.state = {\r\n            selected: false,\r\n            editing: false,\r\n            val: props.project.Name\r\n        };\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <li className={this.props.selected ? \"update-project selected\" : \"update-project\"}\r\n                onClick={event => {\r\n                    event.stopPropagation();\r\n                    this.props.select(() => {\r\n                    });\r\n                }}\r\n            >\r\n                <div className={\"project-name\"}>\r\n                    <input type={'text'}\r\n                           value={this.state.val}\r\n                           disabled={!this.state.editing}\r\n                           ref={this.inputElem}\r\n                           onChange={ev => this.setState({val: ev.target.value})}\r\n                    />\r\n                    <button className={'danger'} onClick={() => this.props.delete()}>\r\n                        Delete\r\n                    </button>\r\n                    <button disabled={this.state.editing}\r\n                            onClick={() => {\r\n                                this.setState({editing: true}, () => this.inputElem.current?.focus());\r\n                            }}\r\n                    >\r\n                        Edit\r\n                    </button>\r\n                    <button disabled={!this.state.editing}\r\n                            onClick={() => {\r\n                                this.props.update(ProjectDescription.Create(this.state.val, this.props.project.Tasks));\r\n                                this.setState({editing: false});\r\n                            }}\r\n                    >\r\n                        Save\r\n                    </button>\r\n                    <button disabled={!this.state.editing}\r\n                            onClick={() => {\r\n                                this.setState({val: this.props.project.Name, editing: false});\r\n                            }}\r\n                    >\r\n                        Cancel\r\n                    </button>\r\n                </div>\r\n                <div className={this.props.selected ? \"project-tags\" : \"hide\"}>\r\n                    <FileDrop\r\n                        className={'file-drop'}\r\n                        onDrop={(files) => {\r\n                            if (files === null) {\r\n                                alert('Please put an actual file into the drop zone.');\r\n                                return;\r\n                            }\r\n                            if (files.length !== 1) {\r\n                                alert('Only input exactly one file into the drag and drop function.')\r\n                                return;\r\n                            }\r\n                            try {\r\n                                const reader = new FileReader();\r\n                                reader.addEventListener('loadend', (e) => {\r\n                                    try {\r\n                                        const parsed = JSON.parse(reader.result as string);\r\n                                        if (Array.isArray(parsed)) {\r\n                                            if (parsed.every(item => ('context' in item) && ('question' in item) && ('tag' in item)))\r\n                                            {\r\n                                                const tasks = JSON.stringify(parsed.map(item => {return {tag: item.tag, description: item.context + item.question}}));\r\n                                                this.props.update(ProjectDescription.Create(this.props.project.Name, tasks));\r\n                                            } else {\r\n                                                alert('Elements in array do not conform to specification.');\r\n                                            }\r\n                                        } else {\r\n                                            alert('Input JSON document should be an array at the top level.');\r\n                                        }\r\n                                    } catch (e) {\r\n                                        console.log(e);\r\n                                        alert(e);\r\n                                    }\r\n                                });\r\n                                reader.readAsText(files[0]);\r\n                            } catch (e) {\r\n                                console.log(e);\r\n                                alert(e);\r\n                            }\r\n                        }}\r\n                    >\r\n                        Drop json file with scenario context here!\r\n                    </FileDrop>\r\n                </div>\r\n                <ul>\r\n                    {\r\n                        this.props.project.parsedTags.map((tag, index) => {\r\n                            return <li key={tag.tag+tag.description}>\r\n                                <h3> {tag.tag} </h3>\r\n                                <p>\r\n                                    {tag.description}\r\n                                </p>\r\n                            </li>;\r\n                        })\r\n                    }\r\n                </ul>\r\n            </li>\r\n        );\r\n    }\r\n\r\n}\r\n\r\nclass UpdateProjects extends React.Component<Props, { selected: number }> {\r\n\r\n    private newInput = React.createRef<HTMLInputElement>();\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            selected: 0\r\n        };\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className={\"status-container\"} onClick={() => {\r\n                this.setState({selected: -1})\r\n            }}>\r\n                <h2>\r\n                    Current Projects:\r\n                </h2>\r\n                <ul className={'projects'}>\r\n                    {\r\n                        this.props.projects.map((project, index) =>\r\n                            <UpdateProject\r\n                                project={project}\r\n                                selected={index === this.state.selected}\r\n                                delete={() => {\r\n                                    store.dispatch((() => {\r\n                                        return async (dispatch: any) => {\r\n                                            const name = project.Name;\r\n                                            const projectSave = ProjectDescription.Create(name, project.Tasks);\r\n                                            try {\r\n                                                await table?.deleteEntity(projectSave);\r\n                                                dispatch(\r\n                                                    this.props.updateProjects(\r\n                                                        this.props.projects.filter(\r\n                                                            value => value.Name !== projectSave.Name\r\n                                                        )\r\n                                                    )\r\n                                                );\r\n                                            } catch (e) {\r\n                                                alert(`Could not delete project. Send error output to Riley or debug: ${e}.`);\r\n                                            }\r\n                                        }\r\n                                    })());\r\n                                }}\r\n                                update={(newVal: ProjectDescription) => {\r\n                                    store.dispatch((() => {\r\n                                        return async (dispatch: any) => {\r\n                                            const tasks = project.parsedTags;\r\n                                            if (project.Name === newVal.Name\r\n                                                && tasks.length === newVal.parsedTags.length\r\n                                            ) {\r\n                                                return;\r\n                                            }\r\n                                            try {\r\n                                                await table?.deleteEntity(project);\r\n                                                await table?.put(newVal);\r\n                                                dispatch(\r\n                                                    this.props.updateProjects(\r\n                                                        [...this.props.projects.filter(\r\n                                                            value => value.Name !== newVal.Name\r\n                                                        ), newVal]\r\n                                                    )\r\n                                                );\r\n                                            } catch (e) {\r\n                                                alert(`Could not update project. Send error output to Riley or debug: ${e}.`);\r\n                                            }\r\n                                        }\r\n                                    })());\r\n                                }}\r\n                                select={(callback) => {\r\n                                    this.setState({selected: index}, callback);\r\n                                }}\r\n                                key={project.Name}\r\n                            />)\r\n                    }\r\n                    <li>\r\n                        <input ref={this.newInput} type={'text'} placeholder={'New Project Name...'}/>\r\n                        <button onClick={() => {\r\n                            store.dispatch((() => {\r\n                                return async (dispatch: any) => {\r\n                                    if (this.newInput.current && this.newInput.current.value.trim() !== '') { // check that input fits params\r\n                                        try {\r\n                                            const newProjectName = ProjectDescription.Create((this.newInput as any).current.value, '');\r\n                                            await table?.put(newProjectName);\r\n                                            dispatch(this.props.updateProjects([...this.props.projects, newProjectName]));\r\n                                            this.newInput.current.value = '';\r\n                                        } catch (e) {\r\n                                            alert(`Could not add project. Send error output to Riley or debug: ${e}.`);\r\n                                        }\r\n                                    }\r\n                                }\r\n                            })());\r\n                        }}>\r\n                            Add\r\n                        </button>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n        );\r\n    }\r\n\r\n}\r\n\r\nexport default connector(UpdateProjects);","import React from \"react\";\r\nimport { connect, ConnectedProps } from 'react-redux'\r\nimport {\r\n    Data,\r\n    RootState,\r\n    StudentProjectIteration,\r\n    updateSubmitHITData,\r\n    updateSPIData,\r\n    SubmitHITDataType\r\n} from \"../redux/actions\";\r\nconst csvp = require('csv-parse');\r\n\r\nconst mapState = (state: RootState) => {\r\n    return {\r\n        currentProject: state.currentProject,\r\n        currentIteration: state.currentIteration,\r\n        spiData: state.spiData,\r\n        students: state.students,\r\n        submitHITData: state.submitHITData\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    updateSPIData,\r\n    updateSubmitHITData\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatchToProps);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>;\r\n\r\ntype Props = PropsFromRedux & {};\r\n\r\ntype State = {\r\n    input: string;\r\n    displayTable: boolean;\r\n    compiler: Compiler;\r\n}\r\n\r\ntype Condition = (input: string[]) => boolean;\r\n\r\nfunction createCond(index: number, value: string) {\r\n    return (input: string[]) => input[index] === value;\r\n}\r\n\r\nclass Compiler {\r\n\r\n    private static instance = new Compiler();\r\n\r\n    private data: Data | null;\r\n    private filterExpr: string | null;\r\n\r\n    constructor() {\r\n        this.data = null;\r\n        this.filterExpr = null;\r\n    }\r\n\r\n    setData(data: Data | null) {\r\n        this.data = data;\r\n        return this;\r\n    }\r\n\r\n    setFilterExpression(expr: string | null) {\r\n        this.filterExpr = expr;\r\n        return this;\r\n    }\r\n\r\n    static I() {\r\n        return Compiler.instance;\r\n    }\r\n\r\n    private lex() {\r\n        if (this.filterExpr === null) {\r\n            throw new Error('filter expression has not been set yet, therefore lex cannot be called yet');\r\n        }\r\n        return this\r\n            .filterExpr\r\n            .trim()\r\n            .split(' ')\r\n            .map(tok => tok.trim())\r\n            .filter(tok => tok !== '');\r\n    }\r\n\r\n    private key(k: string) {\r\n        if (this.data === null) {\r\n            throw new Error('data has not been set yet, therefore key cannot be called yet');\r\n        }\r\n        if (k === '&&' || k === '==') {\r\n            throw new Error('invalid key supplied (special symbol was provided instead of a key)');\r\n        }\r\n        const ind = this.data.header.indexOf(k);\r\n        console.log(k, ind);\r\n        if (ind === -1) {\r\n            throw new Error('invalid key supplied');\r\n        }\r\n        return ind;\r\n    }\r\n\r\n    private eq(k: string) {\r\n        if (k !== '==') {\r\n            throw new Error('invalid equality detected');\r\n        }\r\n    }\r\n\r\n    private value(k: string) {\r\n        if (k === '&&' || k === '==') {\r\n            throw new Error('invalid value supplied (special symbol was provided instead of a value)');\r\n        }\r\n        return k;\r\n    }\r\n\r\n    private amper(k: string) {\r\n        if (k !== '&&') {\r\n            throw new Error('invalid expression connector detected');\r\n        }\r\n    }\r\n\r\n    private parse(tokens: string[]): Condition[] {\r\n        if (tokens.length < 3) {\r\n            throw new Error('cannot parse expression with less than 3 tokens')\r\n        }\r\n        if (tokens.length % 2 !== 1) {\r\n            throw new Error('cannot parse expression with even number of tokens');\r\n        }\r\n        let conds: Condition[] = [];\r\n        let ind = -1;\r\n        let val = '';\r\n        tokens.forEach((tok, i) => {\r\n            switch (i % 4) {\r\n                case 0:\r\n                    ind = this.key(tok);\r\n                    break;\r\n                case 1:\r\n                    this.eq(tok);\r\n                    break;\r\n                case 2:\r\n                    val = this.value(tok);\r\n                    conds.push(createCond(ind, val));\r\n                    break;\r\n                case 3:\r\n                    this.amper(tok);\r\n                    break;\r\n                default:\r\n                    throw new Error('i dont know how i got here, and should not have');\r\n            }\r\n\r\n        });\r\n        return conds;\r\n    }\r\n\r\n    private evaluate(conditions: Condition[]): string[][] {\r\n        if (this.data === null) {\r\n            throw new Error('data is null, cannot evaluate a an expression without any data')\r\n        }\r\n        const ret = this.data.values.filter(row => {\r\n            return conditions.map(cond => cond(row)).every(cond => cond);\r\n        });\r\n        return ret;\r\n    }\r\n\r\n    execute (): string[][] {\r\n        return this.evaluate(this.parse(this.lex()));\r\n    }\r\n}\r\n\r\nclass Table extends React.Component<Props, State> {\r\n\r\n    private fileInput = React.createRef<HTMLInputElement>();\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            input: '',\r\n            displayTable: false,\r\n            compiler: new Compiler().setData(this.props.submitHITData.data)\r\n        };\r\n    }\r\n\r\n    updateCSVData(csv: string[][]) {\r\n        let header: string[] = [];\r\n        let values: string[][] = [];\r\n        try {\r\n            if (csv.length >= 2) {\r\n                header = csv[0];\r\n                values = csv.slice(1);\r\n            }\r\n        } catch (e) {\r\n            alert(e);\r\n            header = [];\r\n            values = [];\r\n        }\r\n        let dt = undefined;\r\n        if (\r\n            header.length === 3 &&\r\n            ['WUSTL Key', 'Task Tag', 'Count'].every(hk => header.includes(hk))\r\n        ) {\r\n            this.props.updateSubmitHITData({dataType: SubmitHITDataType.COUNT_GIVEN, data: new Data(header, values)});\r\n        } else if (\r\n            header.length === 4 &&\r\n            ['WUSTL Key', 'Task 1', 'Task 2', 'Task 3'].every(hk => header.includes(hk))\r\n        ) {\r\n            this.props.updateSubmitHITData({dataType: SubmitHITDataType.COUNT_NOT_GIVEN, data: new Data(header, values)});\r\n        } else {\r\n            alert('CSV is in invalid format. Cannot load the given file.')\r\n        }\r\n    }\r\n\r\n    renderFileInput() {\r\n            return (\r\n                <form>\r\n                    <input\r\n                        ref={this.fileInput}\r\n                        type={\"file\"}\r\n                        accept={\"text/csv\"}\r\n                        className={\"input-file\"}\r\n                        name={\"csv-input\"}\r\n                        id={\"csv-input\"}\r\n                        onChange={event => {\r\n                            const file = event.target.files?.item(0);\r\n                            if (file) {\r\n                                const fr = new FileReader();\r\n                                fr.onloadend = () => {\r\n                                    if (fr.readyState === FileReader.DONE) {\r\n                                        csvp(fr.result, {}, (err: any, out: string[][]) => {\r\n                                            if (err) {\r\n                                                alert(`Could not parse file correctly. Error: ${err}.`)\r\n                                            } else {\r\n                                                this.updateCSVData(out);\r\n                                            }\r\n                                        });\r\n                                    }\r\n                                };\r\n                                fr.readAsText(file, 'utf-8');\r\n                            }\r\n                        }}\r\n                    />\r\n                    <label\r\n                        className={\"csv-input\"}\r\n                        htmlFor={\"csv-input\"}\r\n                    >\r\n                        Input File of HIT Assignments here...\r\n                    </label>\r\n                </form>\r\n            );\r\n    }\r\n    render() {\r\n        let dispData = [];\r\n        console.log(this.props.submitHITData)\r\n        console.log(this.props.submitHITData.data)\r\n        console.log(this.props.submitHITData.dataType)\r\n        try {\r\n            dispData = this.state.compiler.setData(this.props.submitHITData.data).execute();\r\n        } catch (e) {\r\n            // console.log(e);\r\n            dispData = this.props.submitHITData.data.values;\r\n        }\r\n        return (\r\n            <div className={\"status-container\"}>\r\n                {this.renderFileInput()}\r\n                <input\r\n                    type={\"text\"}\r\n                    value={this.state.input}\r\n                    className={\"filter-input\"}\r\n                    onChange={ev => {\r\n                        this.state.compiler.setFilterExpression(ev.target.value);\r\n                        this.setState({input: ev.target.value});\r\n                    }}\r\n                    placeholder={\"Enter your data filter expression here...\"}\r\n                />\r\n                <DataTable data={new Data(this.props.submitHITData.data.header, dispData)} />\r\n            </div>\r\n        );\r\n    }\r\n\r\n}\r\n\r\nexport class DataTable extends React.Component<{data: Data}, any> {\r\n\r\n    render() {\r\n        if (this.props.data === undefined || this.props.data === null || this.props.data.header.length === 0) {\r\n            return (\r\n                <div>\r\n                    <h2> No data to display. </h2>\r\n                </div>\r\n            );\r\n        }\r\n        return <table className={\"hit-data\"}>\r\n            <thead>\r\n            <tr>\r\n                {\r\n                    this\r\n                        .props\r\n                        .data\r\n                        .header\r\n                        .map((key, index) => <th key={key+index}>{key}</th>)\r\n                }\r\n            </tr>\r\n            </thead>\r\n            <tbody>\r\n            {\r\n                this\r\n                    .props\r\n                    .data\r\n                    .values\r\n                    .map((row, index) =>\r\n                        <tr key={index}>\r\n                            {\r\n                                row\r\n                                    .map((val, index) => <td key={val+index}>{val}</td>)\r\n                            }\r\n                        </tr>\r\n                    )\r\n            }\r\n            </tbody>\r\n        </table>\r\n    }\r\n\r\n}\r\n\r\nexport default connector(Table);\r\n","import {AuthenticationDetails, CognitoUser, CognitoUserPool, CognitoUserSession} from 'amazon-cognito-identity-js';\r\nimport { AwsClient } from 'aws4fetch';\r\nimport {AppJSONHeaders, BaseURL, METHODS, Region} from \"./aws-constants\";\r\nimport {createTable as dbCreateTable} from \"./db\";\r\nimport {fetchProjects, fetchSPIData} from \"../redux/actions\";\r\nimport {store} from \"../redux/store\";\r\n\r\nconst AWS = require(\"aws-sdk\");\r\n\r\nconst IdentityPoolId = \"us-east-1:b69d4b85-5cd8-4a07-aabf-e730ede479d9\";\r\nconst ClientId = \"15f397ambvh0db4i20usm454a0\";\r\nconst UserPoolId = \"us-east-1_B4YHaKqVR\";\r\n\r\nAWS.config.region = Region; // Region\r\nAWS.config.credentials = new AWS.CognitoIdentityCredentials({\r\n    IdentityPoolId: IdentityPoolId,\r\n});\r\n\r\nconst userPool = new CognitoUserPool({\r\n    UserPoolId: UserPoolId,\r\n    ClientId: ClientId,\r\n});\r\n\r\nlet cognitoUser: CognitoUser | null = userPool.getCurrentUser();\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nlet sessionUserAttributes: CognitoUserSession | null | undefined = null;\r\nlet awsFetchClient: AwsClient | null = null;\r\n\r\nconst createCredentials = (result: CognitoUserSession) => {\r\n    AWS.config.credentials = new AWS.CognitoIdentityCredentials({\r\n        IdentityPoolId: IdentityPoolId,\r\n        Logins: {\r\n            [`cognito-idp.${Region}.amazonaws.com/${UserPoolId}`]: result.getIdToken().getJwtToken(),\r\n        },\r\n    });\r\n}\r\n\r\nconst createFetchClient = () => {\r\n    awsFetchClient = new AwsClient({\r\n        secretAccessKey: AWS.config.credentials.secretAccessKey,\r\n        accessKeyId: AWS.config.credentials.accessKeyId,\r\n        sessionToken: AWS.config.credentials.sessionToken\r\n    });\r\n    return !AWS.config.credentials.expired;\r\n}\r\n\r\nconst refreshCredentials = async () => {\r\n    return await new Promise<boolean>((resolve, fail) => {\r\n        AWS.config.credentials.refresh((error: any) => {\r\n            if (error) {\r\n                fail(error);\r\n            }\r\n            createFetchClient();\r\n            resolve(true);\r\n        });\r\n    });\r\n}\r\n\r\nconst createTable = () => {\r\n    if (awsFetchClient === null) {\r\n        throw new Error('AWS Fetch Client is null, cannot construct database connection.');\r\n    }\r\n    dbCreateTable(awsFetchClient as AwsClient);\r\n}\r\n\r\nconst asyncStore = () => {\r\n    store.dispatch(fetchProjects());\r\n    store.dispatch(fetchSPIData());\r\n}\r\n\r\nconst nullifyAllServiceGlobals = () => {\r\n    cognitoUser = null;\r\n    sessionUserAttributes = null;\r\n    awsFetchClient = null;\r\n}\r\n\r\nconst clearIncorrectUserdata = () => {\r\n    cognitoUser = null;\r\n    sessionUserAttributes = null;\r\n}\r\n\r\nexport const awsLogin = async (username: string, password: string) => {\r\n    if (username !== '' && password !== '') { // if username and password are given\r\n        console.log(cognitoUser)\r\n        if (cognitoUser === null) {\r\n            cognitoUser = new CognitoUser({\r\n                Username: username,\r\n                Pool: userPool,\r\n            });\r\n        }\r\n        const authenticationDetails = new AuthenticationDetails({\r\n            Username: username,\r\n            Password: password,\r\n        });\r\n        return await new Promise<boolean>((resolve, fail) => {\r\n\r\n            cognitoUser?.authenticateUser(authenticationDetails, {\r\n                onSuccess: async result => {\r\n                    try {\r\n                        createCredentials(result);\r\n                        await refreshCredentials();\r\n                        createTable();\r\n                        asyncStore();\r\n                        resolve(true);\r\n                    } catch (e) {\r\n                        clearIncorrectUserdata();\r\n                        fail(e);\r\n                    }\r\n                },\r\n\r\n                onFailure: err => {\r\n                    clearIncorrectUserdata();\r\n                    fail(err);\r\n                },\r\n\r\n                newPasswordRequired: (userAttributes, requiredAttributes) => {\r\n                    return cognitoUser?.completeNewPasswordChallenge(password, requiredAttributes, {\r\n                        onSuccess: session => {\r\n                            sessionUserAttributes = session;\r\n                            resolve(true);\r\n                        },\r\n                        onFailure: err => {\r\n                            clearIncorrectUserdata();\r\n                            fail(err);\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        });\r\n    } else {\r\n        return await new Promise<boolean>((resolve, fail) => {\r\n            if (cognitoUser !== null) {\r\n                cognitoUser.getSession(async (err: any, result: any) => {\r\n                    if (result) {\r\n                        try {\r\n                            createCredentials(result);\r\n                            await refreshCredentials();\r\n                            createTable();\r\n                            asyncStore();\r\n                            resolve(true);\r\n                        } catch (e) {\r\n                            clearIncorrectUserdata();\r\n                            console.log(e)\r\n                            fail(e);\r\n                        }\r\n                    } else {\r\n                        clearIncorrectUserdata();\r\n                        fail(err);\r\n                    }\r\n                });\r\n            } else {\r\n                clearIncorrectUserdata();\r\n                fail(\"No user session.\")\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\nexport const awsLogout = async () => {\r\n    if (cognitoUser) {\r\n        return await new Promise<boolean>((resolve, fail) => {\r\n            // @ts-ignore\r\n            try {\r\n                cognitoUser?.signOut();\r\n                nullifyAllServiceGlobals();\r\n                resolve(true);\r\n            } catch (e) {\r\n                nullifyAllServiceGlobals();\r\n                fail(e);\r\n            }\r\n        });\r\n    }\r\n    return true;\r\n}\r\n\r\nexport const downloadAllFiles = async (project: string, iteration: number) => {\r\n    const url = BaseURL + `/logs?project=${project}&iteration=${iteration}`;\r\n    const b64= (await (await (awsFetchClient as AwsClient).fetch(url, {\r\n        method: METHODS.GET,\r\n        headers: AppJSONHeaders()\r\n    })).text());\r\n    const byteString = atob(b64);\r\n    const ab = new ArrayBuffer(byteString.length);\r\n    const ia = new Uint8Array(ab);\r\n\r\n    for (let i = 0; i < byteString.length; i++) {\r\n        ia[i] = byteString.charCodeAt(i);\r\n    }\r\n    return new Blob([ab], { type: 'application/zip' });\r\n}\r\n","import React from \"react\";\r\nimport {RootState, updateStudents} from \"../redux/actions\";\r\nimport {connect, ConnectedProps} from \"react-redux\";\r\nconst csvp = require('csv-parse');\r\n\r\nexport const mapState = (state: RootState) => {\r\n    return {\r\n        students: state.students\r\n    };\r\n};\r\n\r\nexport const mapDispatchToProps = {\r\n    updateStudents\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatchToProps);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>;\r\n\r\ntype Props = PropsFromRedux & {};\r\n\r\nenum UploadStatus {\r\n    NO_UPLOAD = 'No file has been uploaded yet.',\r\n    SUCCESS = 'File has been successfully uploaded and parsed.',\r\n    FAILURE = 'The file that was uploaded could not be parsed or did not validate.',\r\n}\r\n\r\ntype State = {\r\n    fileUploaded: UploadStatus;\r\n}\r\n\r\nexport default connector(class StudentFileInput extends React.Component<Props, State> {\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            fileUploaded: UploadStatus.NO_UPLOAD,\r\n        }\r\n    }\r\n\r\n    validateStudents(values: string[][]): boolean {\r\n        return values.length > 1\r\n            && values[0][0].trim() === 'WUSTL Key'\r\n            && values[0][1].trim() === 'GH Pages URL'\r\n            && values[0][2].trim() === 'AWS IAM ID'\r\n            && values[0][3].trim() === 'AWS IAM SECRET'\r\n            && values.every(row => {\r\n                return row.length === 4;\r\n            });\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className={\"student-file-input\"}>\r\n                <div>\r\n                    <h3>\r\n                        {this.state.fileUploaded}\r\n                    </h3>\r\n                    <FileInput onFileChange={(data: string[][]) => {\r\n                        if (this.validateStudents(data)) {\r\n                            this.props.updateStudents(\r\n                                data\r\n                                    .slice(1)\r\n                                    .map(studData => {\r\n                                        return {\r\n                                            wustlKey: studData[0].trim(),\r\n                                            url: studData[1].trim(),\r\n                                            id: studData[2].trim(),\r\n                                            secret: studData[3].trim(),\r\n                                        };\r\n                                    })\r\n                            );\r\n                            this.setState({fileUploaded: UploadStatus.SUCCESS});\r\n                        } else {\r\n                            this.setState({fileUploaded: UploadStatus.FAILURE});\r\n                        }\r\n                    }} />\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n});\r\n\r\ntype FileInputProps = {\r\n    onFileChange: (values: string[][]) => any\r\n}\r\n\r\nexport class FileInput extends React.Component<FileInputProps, {}> {\r\n\r\n    private fileInput = React.createRef<HTMLInputElement>();\r\n\r\n    render() {\r\n        return (\r\n                <form>\r\n                    <input\r\n                        ref={this.fileInput}\r\n                        type={\"file\"}\r\n                        accept={\"text/csv\"}\r\n                        className={\"input-file\"}\r\n                        name={\"student-input\"}\r\n                        id={\"student-input\"}\r\n                        onChange={event => {\r\n                            const file = event.target.files?.item(0);\r\n                            if (file) {\r\n                                const fr = new FileReader();\r\n                                fr.onloadend = () => {\r\n                                    if (fr.readyState === FileReader.DONE) {\r\n                                        csvp(fr.result, {}, (err: any, out: string[][]) => {\r\n                                            if (err) {\r\n                                                alert(`Could not parse file correctly. Error: ${err}.`)\r\n                                            } else {\r\n                                                console.log(out);\r\n                                                this.props.onFileChange(out);\r\n                                            }\r\n                                        });\r\n                                    }\r\n                                };\r\n                                fr.readAsText(file, 'utf-8');\r\n                            }\r\n                       }}\r\n                    />\r\n                    <label\r\n                        className={\"student-input\"}\r\n                        htmlFor={\"student-input\"}\r\n                    >\r\n                        Input File of Student Credentials Here...\r\n                    </label>\r\n                </form>\r\n        );\r\n    }\r\n\r\n}","import {RootState, login, logout} from \"../redux/actions\";\r\nimport {connect, ConnectedProps} from \"react-redux\";\r\nimport React from \"react\";\r\nimport {awsLogin, awsLogout} from \"../aws/aws-service\";\r\n\r\nconst mapState = (state: RootState) => {\r\n    return {};\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    login,\r\n    logout\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatchToProps);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>;\r\n\r\ntype Props = PropsFromRedux & {};\r\n\r\nexport const Login = connector(class Login extends React.Component<Props, {}> {\r\n\r\n    usernameField = React.createRef<HTMLInputElement>();\r\n    passwordField = React.createRef<HTMLInputElement>();\r\n\r\n    render() {\r\n        return (\r\n            <div id={\"login-container\"}>\r\n                <form onSubmit={\r\n                    async ev => {\r\n                        ev.preventDefault();\r\n                        if (this.usernameField.current &&\r\n                            this.passwordField.current\r\n                        ) {\r\n                            const success = await awsLogin(this.usernameField.current.value, this.passwordField.current.value)\r\n                            if (success) {\r\n                                this.props.login();\r\n                            }\r\n                        }\r\n                    }}\r\n                    >\r\n                    <h1>\r\n                        CSE 256 Console\r\n                    </h1>\r\n                    <fieldset>\r\n                        <label>Username:</label>\r\n                        <input type=\"text\" placeholder={\"Username...\"} ref={this.usernameField} autoComplete=\"username\"/>\r\n                    </fieldset>\r\n                    <fieldset>\r\n                        <label>Password:</label>\r\n                        <input type=\"password\" placeholder={\"Password...\"} ref={this.passwordField} autoComplete=\"current-password\"/>\r\n                    </fieldset>\r\n                    <button className=\"basic\" type=\"submit\"> Login </button>\r\n                </form>\r\n            </div>\r\n        );\r\n    }\r\n\r\n});\r\n\r\nexport const Logout = connector(class Logout extends React.Component<Props, {}> {\r\n\r\n    render() {\r\n        return (<button className=\"safe\" onClick={async () => {\r\n            if (await awsLogout()) {\r\n                this.props.logout();\r\n            }\r\n        }}> Logout </button>);\r\n    }\r\n\r\n});","import React from \"react\";\r\n\r\ntype Props = {\r\n    buttonTitle: string;\r\n    description: string;\r\n    buttonClass: string;\r\n    onClick: (ev: React.MouseEvent<HTMLButtonElement, MouseEvent>) => any;\r\n    display: boolean;\r\n};\r\n\r\ntype State = {\r\n    display: boolean;\r\n};\r\n\r\nexport default class ButtonWithDescription extends React.Component<Props, State> {\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            display: false\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return this.props.display ? (\r\n            <div className={'button-with-description'}>\r\n                <div className={'button-container'}>\r\n                    <button onClick={this.props.onClick} className={this.props.buttonClass}>{this.props.buttonTitle}</button>\r\n                    <button className=\"info\" onClick={() => this.setState({display: !this.state.display})}>Info</button>\r\n                </div>\r\n                <div className={this.state.display ? 'action-description' : 'action-description hide'}>{this.props.description}</div>\r\n            </div>\r\n        ): null;\r\n    }\r\n}\r\n","import React from \"react\";\r\nimport {RootState, updateStudents, updateSPIData, SPIData} from \"../redux/actions\";\r\nimport {connect, ConnectedProps} from \"react-redux\";\r\nimport ButtonWithDescription from \"./button-with-description\";\r\n\r\nexport const mapState = (state: RootState) => {\r\n    return {\r\n        currentIteration: state.currentIteration,\r\n        currentProject: state.currentProject,\r\n        students: state.students,\r\n        spiData: state.spiData\r\n    };\r\n};\r\n\r\nexport const mapDispatchToProps = {\r\n    updateStudents,\r\n    updateSPIData\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatchToProps);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>;\r\n\r\ntype Props = PropsFromRedux & {};\r\n\r\nenum Generated {\r\n    LOADING ,\r\n    NOT_GENERATED,\r\n    GENERATED,\r\n}\r\n\r\ntype State = {\r\n}\r\n\r\nexport default connector(class HITGenerator extends React.Component<Props, State> {\r\n\r\n    threeRands(max: number) {\r\n        if (max < 3) {\r\n            return [0, 0, 0];\r\n        }\r\n        let rands = [-1, -1, -1];\r\n        let index = 0;\r\n        while(rands.indexOf(-1) !== -1) {\r\n            const ri = Math.floor(Math.random() * Math.floor(max));\r\n            if (rands.indexOf(ri) === -1) {\r\n                rands[index] = ri;\r\n                index += 1;\r\n            }\r\n        }\r\n        return rands;\r\n    }\r\n\r\n    generate() {\r\n        if (this.props.spiData === null) {\r\n            alert('Cannot generate when data has not been loaded from database.');\r\n        }\r\n        const tasks = this.props.currentProject.parsedTags;\r\n        if (tasks !== undefined\r\n            && tasks.length === 0\r\n        ) {\r\n            alert('Cannot generate task assignment when no tasks exist for this project. Add tags to this project on Semester Setup > Change Project.')\r\n            return;\r\n        }\r\n        const newSPIData: SPIData = {};\r\n        Object.assign(newSPIData, this.props.spiData);\r\n        this.props.students.forEach(stud => {\r\n            // @ts-ignore\r\n            let studSPI = newSPIData[stud.wustlKey];\r\n            if (studSPI === undefined) {\r\n                studSPI = {};\r\n                // @ts-ignore\r\n                newSPIData[stud.wustlKey] = studSPI;\r\n            }\r\n            let pis = studSPI[this.props.currentProject.Name];\r\n            if (pis === undefined) {\r\n                pis = [];\r\n                studSPI[this.props.currentProject.Name] = pis;\r\n            }\r\n            while (pis.length <= this.props.currentIteration) {\r\n                pis.push({tasks: []});\r\n            }\r\n            const rands = this.threeRands(tasks.length);\r\n            const tags = rands.map(ind => tasks[ind]);\r\n            pis[this.props.currentIteration].tasks = [\r\n                {\r\n                    name: tags[0].tag,\r\n                    count: 0\r\n                },\r\n                {\r\n                    name: tags[1].tag,\r\n                    count: 0\r\n                },\r\n                {\r\n                    name: tags[2].tag,\r\n                    count: 0\r\n                },\r\n            ];\r\n            console.log(pis[pis.length - 1]);\r\n        });\r\n        this.props.updateSPIData(newSPIData);\r\n        // upload new data to database\r\n    }\r\n\r\n    render() {\r\n        const generated = this.props.spiData === null\r\n            ? Generated.LOADING\r\n            : this.props.students.some(stud => {\r\n                const studData = (this.props.spiData as SPIData)[stud.wustlKey];\r\n                if (studData) {\r\n                    const pi = studData[this.props.currentProject.Name];\r\n                    if (pi) {\r\n                        return pi[this.props.currentIteration] !== undefined;\r\n                    }\r\n                }\r\n                return false;\r\n            }) ? Generated.GENERATED : Generated.NOT_GENERATED;\r\n        return (\r\n            <div className={'flex-actions'}>\r\n                <div className={generated === Generated.LOADING ? '' : 'hide'}>\r\n                    <h3>\r\n                        The necessary data to display the available actions has not loaded from the database yet. If the database is properly configured and running this page will automatically refresh when the data is loaded.\r\n                    </h3>\r\n                </div>\r\n                <ButtonWithDescription\r\n                    buttonTitle={'Generate'}\r\n                    description={'This button will generate the HIT assignments for all students. Nothing that is already in the database will be changed, modified, or destroyed by this action. Use this button once for each iteration of each project. This will generate a set of HITs for each student to perform for the requested iteration.'}\r\n                    buttonClass={'safe'}\r\n                    onClick={() => {\r\n                        this.generate();\r\n                    }}\r\n                    display={generated === Generated.NOT_GENERATED}\r\n                />\r\n                <ButtonWithDescription\r\n                    buttonTitle={'Regenerate'}\r\n                    description={'This button will REGENERATE the HIT assignments for all students. This will generate a new list of tasks for each student for this iteration and overwrite them in the database. Only run this if HITs have not already been submitted to MTurk. If they have do not run this or it will be impossible to connect logs generated from MTurk to the student that that log belongs to.'}\r\n                    buttonClass={'danger'}\r\n                    onClick={() => {\r\n                        this.generate();\r\n                    }}\r\n                    display={generated === Generated.GENERATED}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n});","import React from 'react';\r\nimport './App.css';\r\nimport {HitManagementTab, PostHitManagementTab, SemesterManagementTab, SessionManagementTab, Tab} from \"../components/tab\";\r\nimport {login, LoginStatus, logout, RootState} from \"../redux/actions\";\r\nimport {connect, ConnectedProps} from \"react-redux\";\r\nimport {Login} from \"../components/login\";\r\nimport {awsLogin} from \"../aws/aws-service\";\r\n\r\nenum NavLocation {\r\n    SessionManagement = 'session',\r\n    HITManagement = 'deploy',\r\n    PostHITManagement = 'post_deployment',\r\n    SemesterManagement = 'semester_setup',\r\n}\r\n\r\nclass NavBar extends React.Component<{ startNavLocation: NavLocation, onUpdateActive: (input: NavLocation) => any }, { currentActive: { index: number, navLocation: NavLocation } }> {\r\n    rs = new Array<() => React.RefObject<HTMLButtonElement>>(Object.keys(NavLocation).length).fill(() => React.createRef<HTMLButtonElement>(), 0, Object.keys(NavLocation).length).map(fun => fun());\r\n\r\n    constructor(props: { startNavLocation: NavLocation, onUpdateActive: (input: NavLocation) => any }) {\r\n        super(props);\r\n        this.state = {\r\n            currentActive: {index: 0, navLocation: NavLocation.SemesterManagement}\r\n        };\r\n    }\r\n\r\n    updateActive(index: number, navLocation: NavLocation) {\r\n        const oldActive = this.state.currentActive;\r\n        if (oldActive.index === index) {\r\n            return;\r\n        }\r\n        this.rs[oldActive.index].current?.classList.remove('active');\r\n        this.rs[index].current?.classList.add('active');\r\n        this.setState({currentActive: {index: index, navLocation: navLocation}});\r\n        this.props.onUpdateActive(navLocation);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <nav className=\"header\">\r\n                {\r\n                    [\r\n                        (<div className={\"filler logo\"} key={-1}>\r\n                            CSE 256\r\n                        </div>), ...this.rs.map((val, index) => {\r\n                        const ind = index;\r\n                        const navLocation = Object.values(NavLocation)[ind];\r\n                        return (\r\n                            <button ref={val} key={ind}\r\n                                    className={this.props.startNavLocation === navLocation ? \"active\" : \"\"}\r\n                                    onClick={() => this.updateActive(ind, navLocation)}>\r\n                                {\r\n                                    navLocation\r\n                                        .split(\"_\")\r\n                                        .map(str => str.charAt(0).toUpperCase() + str.slice(1))\r\n                                        .join(\" \")\r\n                                }\r\n                            </button>\r\n                        );\r\n                    })]\r\n                }\r\n            </nav>\r\n        );\r\n    }\r\n\r\n}\r\n\r\nclass Footer extends React.Component<{}, {}> {\r\n    render() {\r\n        return (\r\n            <div className={\"footer\"}>\r\n                <div className={\"attribution\"}>\r\n                    Icons made by&nbsp;\r\n                    <a href=\"https://www.flaticon.com/authors/google\" title=\"Google\">\r\n                        Google\r\n                    </a>\r\n                    &nbsp;from&nbsp;\r\n                    <a href=\"https://www.flaticon.com/\" title=\"Flaticon\">\r\n                        www.flaticon.com\r\n                    </a>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nconst mapState = (state: RootState) => {\r\n    return {\r\n        loggedIn: state.loggedIn\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    login,\r\n    logout\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatchToProps);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>;\r\n\r\ntype Props = PropsFromRedux & {};\r\n\r\ntype TabRef = {tab: Tab | undefined}\r\ntype TabMap = {[key: string]: TabRef}\r\n\r\nclass Tabs extends React.Component<any, { navLocation: NavLocation }> {\r\n\r\n    rs: TabMap = {\r\n        [NavLocation.SemesterManagement as string]: {tab: undefined},\r\n        [NavLocation.HITManagement as string]: {tab: undefined},\r\n        [NavLocation.PostHITManagement as string]: {tab: undefined},\r\n        [NavLocation.SessionManagement as string]: {tab: undefined},\r\n    };\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            navLocation: NavLocation.SessionManagement,\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        // eslint-disable-next-line no-restricted-globals\r\n        const loc = location.hash;\r\n        if (loc === \"\") {\r\n            return;\r\n        }\r\n        const path = loc.split(\".\");\r\n        if (path.length >= 3) {\r\n            return;\r\n        }\r\n        const tab = path[0].slice(1) as NavLocation;\r\n        const action = path.length === 2 ? path[1] : \"\";\r\n        if (Object.values(NavLocation).includes(tab)) {\r\n            this.setState({navLocation: tab}, () => {\r\n                (this.rs[tab].tab as Tab).displayName(action);\r\n            });\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n        <div className=\"app\">\r\n            <NavBar startNavLocation={this.state.navLocation}\r\n                    onUpdateActive={(navLocation) => this.setState({navLocation: navLocation})}/>\r\n            <SessionManagementTab tabRef={this.rs[NavLocation.SessionManagement]} display={this.state.navLocation === NavLocation.SessionManagement}/>\r\n            <HitManagementTab tabRef={this.rs[NavLocation.HITManagement]} display={this.state.navLocation === NavLocation.HITManagement}/>\r\n            <PostHitManagementTab tabRef={this.rs[NavLocation.PostHITManagement]} display={this.state.navLocation === NavLocation.PostHITManagement}/>\r\n            <SemesterManagementTab tabRef={this.rs[NavLocation.SemesterManagement]} display={this.state.navLocation === NavLocation.SemesterManagement}/>\r\n            <Footer/>\r\n        </div>\r\n        );\r\n    }\r\n\r\n}\r\n\r\nclass App extends React.Component<Props, {}> {\r\n\r\n    componentDidMount() {\r\n        console.log(\"mounted\")\r\n        awsLogin('', '')\r\n            .then(\r\n                value => {\r\n                    if (value) {\r\n                        console.log(\"login\")\r\n                        this.props.login();\r\n                    } else {\r\n                        console.log(\"logout\")\r\n                        this.props.logout();\r\n                    }\r\n                },\r\n                reason => {\r\n                    console.log(reason)\r\n                    this.props.logout();\r\n                    // error -> rejection\r\n                })\r\n            .catch(reason => {\r\n                // do nothing\r\n                console.log(\"logout\")\r\n                console.log(reason)\r\n                this.props.logout();\r\n            });\r\n    }\r\n\r\n    render() {\r\n        if (this.props.loggedIn === LoginStatus.UNATTEMPTED) {\r\n            return <div className={\"app splash\"}></div>;\r\n        } else if (this.props.loggedIn === LoginStatus.SUCCEEDED) {\r\n            return <Tabs></Tabs>;\r\n        } else {\r\n            return <div className=\"app\"><Login/></div>;\r\n        }\r\n    }\r\n}\r\n\r\nexport default connector(App);\r\n","import React from 'react';\r\nimport {MTurkMode, RootState, updateMTurkMode} from \"../redux/actions\";\r\nimport {connect, ConnectedProps} from \"react-redux\";\r\n\r\ntype Props = {\r\n    onChange: (num: number) => any;\r\n    toggles: {text: string, action?: () => any}[];\r\n    active: number;\r\n}\r\n\r\nexport class Toggle extends React.Component<Props, {}> {\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n    }\r\n\r\n    onClick(active: number) {\r\n        this.props.onChange(active);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"toggle-container\">\r\n                {\r\n                    this.props.toggles.map((toggle, ind) =>\r\n                        <button\r\n                            key={toggle.text}\r\n                            className={this.props.active === ind ? \"safe toggle active\" : \"safe toggle\"}\r\n                            onClick={() => {\r\n                                this.onClick(ind);\r\n                                if (toggle.action) {\r\n                                    toggle.action();\r\n                                }\r\n                            }}\r\n                        >\r\n                            {toggle.text}\r\n                        </button>\r\n                    )\r\n                }\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\ntype SingleToggleState = {\r\n    active: number;\r\n}\r\n\r\nexport class SingleToggle extends React.Component<Props, SingleToggleState> {\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            active: props.active\r\n        };\r\n    }\r\n\r\n    onClick(active: number) {\r\n        this.props.onChange(active);\r\n        this.setState({active: active});\r\n    }\r\n\r\n    render() {\r\n        return <Toggle\r\n            onChange={num => this.onClick(num)}\r\n            toggles={this.props.toggles}\r\n            active={this.state.active}\r\n        />;\r\n    }\r\n}\r\n\r\nexport const mapStateSandboxToggle = (state: RootState) => {\r\n    return {\r\n        mturkMode: state.mturkMode,\r\n    };\r\n};\r\n\r\nexport const mapDispatchToSandboxToggleProps = {\r\n    updateMTurkMode,\r\n};\r\n\r\nconst sandboxToggleConnector = connect(mapStateSandboxToggle, mapDispatchToSandboxToggleProps);\r\n\r\ntype SandboxToggleProps = ConnectedProps<typeof sandboxToggleConnector>;\r\n\r\ntype SandboxToggleState = {}\r\n\r\nexport const SandboxToggle = sandboxToggleConnector(class SandboxToggle extends React.Component<SandboxToggleProps, SandboxToggleState>{\r\n\r\n    render() {\r\n        return (\r\n            <Toggle\r\n                onChange={(num: number) => {\r\n                    const sandbox = num === 0; // 1 is real mturk\r\n                    // set the global state of sandbox to true\r\n                }}\r\n                active={this.props.mturkMode === MTurkMode.SANDBOX ? 0 : 1}\r\n                toggles={[\r\n                    {\r\n                        text: \"Submit to Sandbox MTurk\",\r\n                        action: () => {\r\n                            this.props.updateMTurkMode(MTurkMode.SANDBOX);\r\n                        }\r\n                    },\r\n                    {\r\n                        text: \"Submit to Real MTurk\",\r\n                        action: () => {\r\n                            this.props.updateMTurkMode(MTurkMode.REAL);\r\n                        }\r\n                    }\r\n                ]}\r\n            />\r\n        );\r\n    }\r\n});\r\n","import React from \"react\";\r\nimport {AccountPair} from \"../aws/mturk\";\r\nimport {fetchAccountBalances, RootState} from \"../redux/actions\";\r\nimport {connect, ConnectedProps} from \"react-redux\";\r\nimport {store} from \"../redux/store\";\r\nimport {SandboxToggle} from \"./toggle\";\r\n\r\nexport const mapState = (state: RootState) => {\r\n    return {\r\n        balances: state.accountBalances,\r\n        mturkMode: state.mturkMode,\r\n    };\r\n};\r\n\r\nexport const mapDispatchToProps = {};\r\n\r\nconst connector = connect(mapState, mapDispatchToProps);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>;\r\n\r\ntype Props = PropsFromRedux & {};\r\ntype State = {};\r\n\r\nclass AccountBalances extends React.Component<Props, State> {\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n    }\r\n\r\n    componentDidMount() {\r\n        if (this.props.balances === []) {\r\n            store.dispatch(fetchAccountBalances(this.props.mturkMode));\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <button className={\"act basic refresh\"} onClick={() => store.dispatch(fetchAccountBalances(this.props.mturkMode))}> Refresh </button>\r\n                <SandboxToggle />\r\n                <table className={\"component\"}>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>\r\n                                WUSTL Key\r\n                            </th>\r\n                            <th>\r\n                                Balance\r\n                            </th>\r\n                            <th>\r\n                                Ready for Submission\r\n                            </th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {\r\n                            this.props.balances\r\n                                .sort((a, b) => {\r\n                                    const aVal = parseFloat(a.balance);\r\n                                    const bVal = parseFloat(b.balance);\r\n                                    if (aVal <= 9.99 && bVal <= 9.99) {\r\n                                        return 0;\r\n                                    } else if (aVal <= 9.99) {\r\n                                        return -1;\r\n                                    } else {\r\n                                        return 1;\r\n                                    }\r\n                                })\r\n                                .map((pair: AccountPair) => {\r\n                                const ready = parseFloat(pair.balance) > 9.99;\r\n                                return (<tr key={pair.wustlKey}>\r\n                                    <th>\r\n                                        {pair.wustlKey}\r\n                                    </th>\r\n                                    <td>\r\n                                        {pair.balance}\r\n                                    </td>\r\n                                    <td className={ready ? \"ready\" : \"not-ready\"}>\r\n                                        {ready ? \"Ready\" : \"Not Ready\"}\r\n                                    </td>\r\n                                </tr>);\r\n                            })\r\n                        }\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        );\r\n    }\r\n\r\n}\r\n\r\nexport default connector(AccountBalances);","import React from \"react\";\r\nimport Table, {DataTable} from \"./table\";\r\nimport {Data, fetchSPIData, MTurkMode, RootState, SubmitHITDataType, updateMTurkMode} from \"../redux/actions\";\r\nimport {connect, ConnectedProps} from \"react-redux\";\r\nimport MTPool from \"../aws/mturk\";\r\nimport {SandboxToggle, Toggle} from \"./toggle\";\r\n\r\nexport const mapState = (state: RootState) => {\r\n    return {\r\n        projects: state.projects,\r\n        iterations: state.iterations,\r\n        currentProject: state.currentProject,\r\n        currentIteration: state.currentIteration,\r\n        spiData: state.spiData,\r\n        submitHITData: state.submitHITData,\r\n        students: state.students,\r\n        mturkMode: state.mturkMode,\r\n    };\r\n};\r\n\r\nexport const mapDispatchToProps = {\r\n    updateMTurkMode,\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatchToProps);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>;\r\n\r\ntype Props = PropsFromRedux & {};\r\n\r\ntype State = {\r\n    activeTable: number,\r\n    price: string,\r\n    errors: Data,\r\n}\r\n\r\nclass SubmitHits extends React.Component<Props, State> {\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            activeTable: 0,\r\n            price: '0.40',\r\n            errors: new Data(['WUSTL Key', 'Error', 'Count'], []),\r\n        };\r\n    }\r\n\r\n    getDiffData() {\r\n        fetchSPIData();\r\n        let values: string[][] = [];\r\n        const ret = new Data(this.props.submitHITData.data.header, []);\r\n        try {\r\n            const spiData = this.props.spiData;\r\n            if (spiData !== null) {\r\n                this.props.submitHITData.data.values.forEach(row => {\r\n                    const studData = spiData[row[0]];\r\n                    if (studData) {\r\n                        const projData = studData[this.props.currentProject.Name];\r\n                        if (projData) {\r\n                            const iterData = projData[this.props.currentIteration];\r\n                            if (iterData) {\r\n                                const taskData = iterData.tasks.find(item => item.name === row[1]);\r\n                                if (taskData) {\r\n                                    values.push([\r\n                                        row[0],\r\n                                        row[1],\r\n                                        '' + taskData.count\r\n                                    ]);\r\n                                    return;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    values.push(row);\r\n                });\r\n            } else {\r\n                values = this.props.submitHITData.data.values;\r\n            }\r\n            ret.values = values;\r\n            return ret;\r\n        } catch (e) {\r\n            alert(e);\r\n            return this.props.submitHITData.data;\r\n        }\r\n    }\r\n\r\n    buildURL(wustlKey: string, url: string, taskTag: string) {\r\n        return `${url}/?wustl_key=${wustlKey}&amp;sandbox=${this.props.mturkMode === MTurkMode.SANDBOX}&amp;project=${this.props.currentProject.Name}&amp;iteration=${this.props.currentIteration}&amp;tag=${taskTag}`;\r\n    }\r\n\r\n    async buildFromCountNotGiven(): Promise<{[wustlKey: string]: {count: number, url: string, price: string}[]}> {\r\n        const hitData: {[key: string]: {count: number, url: string, price: string}[]} = {};\r\n        //this.props.cs\r\n        this.props.submitHITData.data.values.forEach(row => {\r\n            const urls: {count: number, url: string, price: string}[] = [];\r\n            const wKey = row[0];\r\n            const tasks = row.slice(1);\r\n            let countSoFar: {[key: string]: number} = {};\r\n            tasks.forEach(tag => {\r\n                countSoFar[tag] = 0;\r\n            });\r\n            if (this.props.spiData) {\r\n                // const studHitConfigData = this.props.spiData[stud.wustlKey][this.props.currentProject.Name][this.props.currentIteration];\r\n                const studConfig = this.props.spiData[wKey];\r\n                if (studConfig) {\r\n                    const studProjConfig = studConfig[this.props.currentProject.Name];\r\n                    if (studProjConfig) {\r\n                        const studHitConfigData = studProjConfig[this.props.currentIteration];\r\n                        if (studHitConfigData) {\r\n                            tasks.forEach(tag => {\r\n                                const task = studHitConfigData.tasks.find(task => task.name === tag);\r\n                                if (task) {\r\n                                    countSoFar[tag] = task.count;\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            const stud = this.props.students.find(stud => stud.wustlKey === wKey);\r\n            console.log(wKey);\r\n            if (stud) {\r\n                tasks.forEach(tag => {\r\n                    urls.push({\r\n                        count:  Math.max(0, 3 - countSoFar[tag]),\r\n                        url: this.buildURL(stud.wustlKey, stud.url, tag),\r\n                        price: this.state.price\r\n                    });\r\n                });\r\n            }\r\n            hitData[wKey] = urls;\r\n            console.log(urls);\r\n        });\r\n        return hitData;\r\n    }\r\n\r\n    async buildFromCountGiven(): Promise<{[wustlKey: string]: {count: number, url: string, price: string}[]}> {\r\n        let hitData: {[wustlKey: string]: {count: number, url: string, price: string}[]} = {};\r\n        this.props.submitHITData.data.values.forEach(row => {\r\n            let urls = hitData[row[0]];\r\n            if (urls === undefined) {\r\n                urls = [];\r\n                hitData[row[0]] = urls;\r\n            }\r\n            const stud = this.props.students.find(stud => stud.wustlKey === row[0]);\r\n            if (stud){\r\n                urls.push({\r\n                    count:  parseInt(row[2]),\r\n                    url: this.buildURL(stud.wustlKey, stud.url, row[1]),\r\n                    price: this.state.price\r\n                });\r\n            }\r\n        });\r\n        console.log(hitData)\r\n        return hitData;\r\n    }\r\n\r\n    buildURLS(): Promise<{[wustlKey: string]: {count: number, url: string, price: string}[]}> {\r\n        if (this.props.submitHITData.dataType === SubmitHITDataType.COUNT_GIVEN) {\r\n            return this.buildFromCountGiven();\r\n        } else {\r\n            return this.buildFromCountNotGiven();\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return <div>\r\n            <button\r\n                className={\"refresh danger\"}\r\n                onClick={async () => {\r\n                    const hitData = await this.buildURLS();\r\n                    const resp = await MTPool.uploadHits(hitData, this.props.mturkMode);\r\n                    this.state.errors.resetValues();\r\n                    for(let i = 0; i < resp.length; i++) {\r\n                        const re = await resp[i];\r\n                        if ('error' in re) {\r\n                            const row = this.state.errors.findFirstEntry([{index: 0, expectedValue: re.wustlKey}, {index: 1, expectedValue: re.code}]);\r\n                            if (row) {\r\n                                row[row.length - 1] = '' + (parseInt(row[row.length - 1]) + 1);\r\n                            } else {\r\n                                this.state.errors.values.push([re.wustlKey, re.code, re.error, '1']);\r\n                            }\r\n                        } else {\r\n                            // do nothing, got updated account balances\r\n                        }\r\n                    }\r\n                }}\r\n            > Submit Hits </button>\r\n            <SandboxToggle />\r\n            <Toggle\r\n                onChange={(num: number) => {\r\n                    this.setState({activeTable: num});\r\n                }}\r\n                toggles={[\r\n                    {\r\n                        text: \"Original Assignments\",\r\n                    },\r\n                    {\r\n                        text: \"Remaining Assignments\",\r\n                    }\r\n                ]}\r\n                active={0}\r\n            />\r\n            <div className={'payment-input'}>\r\n                <label>\r\n                    Payout per HIT:\r\n                </label>\r\n                <input type={'number'} value={this.state.price} onChange={ev => this.setState({price: parseFloat(ev.target.value).toFixed(2)})} min={.05} max={.95} step={0.05}/>\r\n            </div>\r\n            {\r\n                this.state.activeTable === 0 ? <Table/> : <DataTable data={this.getDiffData()}/>\r\n            }\r\n            <div>\r\n                <h3>\r\n                    Errors for submission:\r\n                </h3>\r\n                <DataTable data={this.state.errors} />\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\nexport default connector(SubmitHits);\r\n","import React from \"react\";\r\nimport {RootState} from \"../redux/actions\";\r\nimport {connect, ConnectedProps} from \"react-redux\";\r\nimport MTPool from \"../aws/mturk\";\r\n\r\nexport const mapState = (state: RootState) => {\r\n    return {\r\n        projects: state.projects,\r\n        iterations: state.iterations,\r\n        currentProject: state.currentProject,\r\n        currentIteration: state.currentIteration,\r\n        spiData: state.spiData,\r\n        students: state.students,\r\n    };\r\n};\r\n\r\nexport const mapDispatchToProps = {\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatchToProps);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>;\r\n\r\ntype Props = PropsFromRedux & {};\r\n\r\ntype State = {\r\n}\r\n\r\nclass CancelHits extends React.Component<Props, State> {\r\n\r\n    render() {\r\n        return (\r\n            <div className={\"status-container\"}>\r\n                <button className={\"status-update safe right\"} onClick={async () => {\r\n                    MTPool.cancelHits();\r\n                }}>\r\n                    Cancel\r\n                </button>\r\n                <h2>\r\n                    Cancel all HITs.\r\n                </h2>\r\n                <p>\r\n                    Cancels all live hits for all individuals listed in the current credentials file.\r\n                </p>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connector(CancelHits);","import React from \"react\";\r\nimport {downloadAllFiles} from \"../aws/aws-service\";\r\nimport {RootState} from \"../redux/actions\";\r\nimport {connect, ConnectedProps} from \"react-redux\";\r\nimport ButtonWithDescription from \"./button-with-description\";\r\n\r\nexport const mapState = (state: RootState) => {\r\n    return {\r\n        currentIteration: state.currentIteration,\r\n        currentProject: state.currentProject\r\n    };\r\n};\r\n\r\nexport const mapDispatchToProps = {};\r\n\r\nconst connector = connect(mapState, mapDispatchToProps);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>;\r\n\r\ntype Props = PropsFromRedux & {};\r\n\r\ntype State = {\r\n}\r\n\r\nexport default connector(class DownloadZip extends React.Component<Props, State> {\r\n\r\n    async download(iteration: number) {\r\n        const data = await downloadAllFiles(this.props.currentProject.Name, iteration);\r\n\r\n        // https://davidwalsh.name/javascript-download\r\n        const a = document.createElement(\"a\");\r\n        a.style.display = \"none\";\r\n        document.body.appendChild(a);\r\n\r\n        // Set the HREF to a Blob representation of the data to be downloaded\r\n        a.href = window.URL.createObjectURL(data);\r\n\r\n        // Use download attribute to set set desired file name\r\n        a.setAttribute(\"download\", `${this.props.currentProject.Name}_${this.props.currentIteration}.zip`);\r\n\r\n        // Trigger the download by simulating click\r\n        a.click();\r\n\r\n        // Cleanup\r\n        window.URL.revokeObjectURL(a.href);\r\n        document.body.removeChild(a);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <ButtonWithDescription\r\n                    buttonTitle={'Download All 0th Logs'}\r\n                    description={'Downloads all logs in iteration 0. Iteration 0 is meant for use in collecting base line data and not meant for collecting information on student\\'s hits.'}\r\n                    buttonClass={'safe'}\r\n                    onClick={() => this.download(0)}\r\n                    display={true}\r\n                />\r\n                <ButtonWithDescription\r\n                    buttonTitle={`Download All Logs for ${this.props.currentProject.Name} project, iteration ${this.props.currentIteration}.`}\r\n                    description={'Downloads all logs for the currently selected project and iteration. This is meant for collecting logs for student\\'s hits following a successful HIT deployment to MTurk.'}\r\n                    buttonClass={'safe'}\r\n                    onClick={() => this.download(this.props.currentIteration)}\r\n                    display={true}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n});","import React from \"react\";\r\nimport {Data, RootState, updateMTurkMode} from \"../redux/actions\";\r\nimport {connect, ConnectedProps} from \"react-redux\";\r\nimport {DataTable} from \"./table\";\r\nimport ButtonWithDescription from \"./button-with-description\";\r\nimport MTPool from \"../aws/mturk\";\r\nconst csvp = require('csv-parse');\r\n\r\nexport const mapState = (state: RootState) => {\r\n    return {\r\n        projects: state.projects,\r\n        iterations: state.iterations,\r\n        currentProject: state.currentProject,\r\n        currentIteration: state.currentIteration,\r\n        spiData: state.spiData,\r\n        submitHITData: state.submitHITData,\r\n        students: state.students,\r\n        mturkMode: state.mturkMode,\r\n    };\r\n};\r\n\r\nexport const mapDispatchToProps = {\r\n    updateMTurkMode,\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatchToProps);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>;\r\n\r\ntype Props = PropsFromRedux & {};\r\n\r\ntype State = {\r\n    data: Data,\r\n}\r\n\r\nclass PayHits extends React.Component<Props, State> {\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            data: new Data([], []),\r\n        };\r\n    }\r\n\r\n    updateCSVData(data: string[][]) {\r\n        this.setState({data: new Data(data[0], data.slice(1))});\r\n    }\r\n\r\n    renderFileInput() {\r\n        return (\r\n            <form>\r\n                <input\r\n                    //ref={this.fileInput}\r\n                    type={\"file\"}\r\n                    accept={\"text/csv\"}\r\n                    className={\"input-file\"}\r\n                    name={\"csv-input-1\"}\r\n                    id={\"csv-input-1\"}\r\n                    onChange={event => {\r\n                        const file = event.target.files?.item(0);\r\n                        if (file) {\r\n                            const fr = new FileReader();\r\n                            fr.onloadend = () => {\r\n                                if (fr.readyState === FileReader.DONE) {\r\n                                    csvp(fr.result, {}, (err: any, out: string[][]) => {\r\n                                        if (err) {\r\n                                            alert(`Could not parse file correctly. Error: ${err}.`)\r\n                                        } else {\r\n                                            this.updateCSVData(out);\r\n                                        }\r\n                                    });\r\n                                }\r\n                            };\r\n                            fr.readAsText(file, 'utf-8');\r\n                        }\r\n                    }}\r\n                />\r\n                <label\r\n                    className={\"csv-input\"}\r\n                    htmlFor={\"csv-input-1\"}\r\n                >\r\n                    Input File of HIT Payments here...\r\n                </label>\r\n            </form>\r\n        );\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                {this.renderFileInput()}\r\n                <ButtonWithDescription\r\n                    buttonTitle={'Pay'}\r\n                    description={'Resolves all of the HITs listed with the action that is provided for it. Valid actions are: approve, bonus, and reject.'}\r\n                    buttonClass={'safe'}\r\n                    onClick={() => {\r\n                        MTPool.payHits(this.state.data);\r\n                    }}\r\n                    display={true}\r\n                />\r\n                {this.state.data.values.length === 0 ? null : <DataTable data={this.state.data} />}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connector(PayHits);","import React from \"react\";\r\nimport {DataTable} from \"./table\";\r\nimport {Data, RootState} from \"../redux/actions\";\r\nimport {connect, ConnectedProps} from \"react-redux\";\r\nimport ButtonWithDescription from \"./button-with-description\";\r\nimport MTPool from \"../aws/mturk\";\r\nimport {SandboxToggle} from \"./toggle\";\r\n\r\nexport const mapState = (state: RootState) => {\r\n    return {\r\n        mturkMode: state.mturkMode\r\n    };\r\n};\r\n\r\nexport const mapDispatchToProps = {\r\n};\r\n\r\nconst connector = connect(mapState, mapDispatchToProps);\r\n\r\ntype PropsFromRedux = ConnectedProps<typeof connector>;\r\n\r\ntype Props = PropsFromRedux & {};\r\n\r\ntype State = {\r\n    data: Data,\r\n}\r\n\r\nclass HitStatuses extends React.Component<Props, State> {\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            data: new Data([], []),\r\n        };\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <SandboxToggle />\r\n                <ButtonWithDescription\r\n                    buttonTitle={'Refresh'}\r\n                    description={'Gets the current status of all HITs for all accounts.'}\r\n                    buttonClass={'basic'}\r\n                    onClick={async () => {\r\n                        const data = await MTPool.getStatuses(this.props.mturkMode);\r\n                        this.setState({data: data});\r\n                    }}\r\n                    display={true}\r\n                />\r\n                <DataTable data={this.state.data} />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connector(HitStatuses);\r\n","import React from \"react\";\r\nimport DBStatus from \"./db-status\";\r\nimport ProjectIterationSelector from \"./project-iteration-selector\";\r\nimport UpdateProjects from \"./update-projects\";\r\nimport Table from \"./table\";\r\nimport {Logout} from \"./login\";\r\nimport ButtonWithDescription from \"./button-with-description\";\r\nimport StudentFileInput from \"./file-input\";\r\nimport HITGenerator from \"./hit-generator\";\r\nimport AccountBalances from \"./account-balances\";\r\nimport SubmitHits from \"./submit-hits\";\r\nimport CancelHits from \"./cancel-hits\";\r\nimport DownloadZip from \"./download-zip\";\r\nimport PayHits from \"./pay-hits\";\r\nimport HitStatuses from \"./hit-status\";\r\n\r\ntype TabRef = {tab: Tab | undefined}\r\n\r\ninterface TabProps {\r\n    tabRef: TabRef;\r\n    actions: {urlName: string, name: string, description: string, component: JSX.Element}[];\r\n    display: boolean;\r\n}\r\n\r\ninterface TabState {\r\n    index: number\r\n}\r\n\r\nexport class Tab extends React.Component<TabProps, TabState> {\r\n\r\n    constructor(props: TabProps) {\r\n        super(props);\r\n        this.props.tabRef.tab = this;\r\n        this.state = {\r\n            index: 0,\r\n        }\r\n    }\r\n\r\n    displayName(urlName: string) {\r\n        const index = this.props.actions.findIndex(value => value.urlName === urlName);\r\n        if (index >= 0) {\r\n            this.display(index);\r\n        }\r\n    }\r\n\r\n    display(index: number) {\r\n        this.setState({index});\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className={this.props.display ? \"tab\" : \"tab hide\"}>\r\n                <div className={\"tab-content\"}>\r\n                    <div className={\"sidebar\"}>\r\n                        {\r\n                            [...this.props.actions.map((action, index) => (\r\n                                <button\r\n                                    className={index === this.state.index ? 'action active' : 'action'}\r\n                                    onClick={() => this.display(index)}\r\n                                    key={index}\r\n                                >\r\n                                    {\r\n                                        action.name\r\n                                    }\r\n                                </button>\r\n                            )), <div className={\"sidebar-filler\"} key={this.props.actions.length}> </div>]\r\n                        }\r\n                    </div>\r\n                    <div className={\"output-container\"}>\r\n                        <div className={\"output\"}>\r\n                            {this.props.children ? this.props.children: null}\r\n                            {\r\n                                this.props.actions.map((action, index) => {\r\n                                    return (\r\n                                        <div\r\n                                            className={index === this.state.index ? 'component-wrapper' : 'component-wrapper hide'}\r\n                                            key={index}\r\n                                        >\r\n                                            <div className={'tab-header'}>\r\n                                                <h1>\r\n                                                    {\r\n                                                        action.name\r\n                                                    }\r\n                                                </h1>\r\n                                                <p className={\"description\"}>\r\n                                                    {\r\n                                                        action.description\r\n                                                    }\r\n                                                </p>\r\n                                            </div>\r\n                                            {\r\n                                                action.component\r\n                                            }\r\n                                        </div>\r\n                                    );\r\n                                })\r\n                            }\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n}\r\n\r\ninterface ConcreteTabProps {\r\n    display: boolean;\r\n    tabRef: TabRef;\r\n}\r\n\r\nexport class SemesterManagementTab extends React.Component<ConcreteTabProps, {}> {\r\n\r\n    render() {\r\n        return <Tab\r\n            tabRef={this.props.tabRef}\r\n            display={this.props.display}\r\n            actions={[\r\n                {\r\n                    urlName: 'clear_db',\r\n                    name: 'Clear Database',\r\n                    description: 'Deletes all data from the database that is specific to a semester. Retains login data and other non-semester specific data.',\r\n                    component: (<div>\r\n                                    <div>\r\n                                        <ButtonWithDescription buttonTitle={'Clear Database'}\r\n                                                               description={'Clicking this button will delete all data from the database that is not meant to be carried over. This includes: HIT assignments, Student ID to HIT ID mappings and more. Click this button once the semester is completely over and you are ready to clean out all of the old data.'}\r\n                                                               buttonClass={'danger'} onClick={() => {}} display={true} />\r\n                                    </div>\r\n                                    <DBStatus/>\r\n                                </div>)\r\n                },\r\n                {\r\n                    urlName: 'change_projects',\r\n                    name: 'Change Projects',\r\n                    description: 'Allows you to view and change projects for this course.',\r\n                    component: <UpdateProjects/>\r\n                }\r\n            ]}\r\n        />\r\n    }\r\n\r\n}\r\n\r\nexport class HitManagementTab extends React.Component<ConcreteTabProps, {}> {\r\n\r\n    render() {\r\n        return <Tab\r\n            tabRef={this.props.tabRef}\r\n                display={this.props.display}\r\n                actions={[\r\n                    {\r\n                        urlName: 'generate_hits',\r\n                        name: 'Generate HITs',\r\n                        description: 'Generate HITs for each student. HITs will be generated based on current project and iteration as well as information about which HITs that they have had for previous iterations.',\r\n                        component: (\r\n                            <div>\r\n                                <HITGenerator/>\r\n                                <DBStatus/>\r\n                                <Table />\r\n                            </div>\r\n                        )\r\n                    },\r\n                    {\r\n                        urlName: 'check_account_balances',\r\n                        name: 'Check Account Balances',\r\n                        description: 'Checks the account balances for all accounts in the uploaded credentials file.',\r\n                        component: <AccountBalances />\r\n                    },\r\n                    {\r\n                        urlName: 'submit_hits',\r\n                        name: 'Submit HITs',\r\n                        description: 'Submit hits for the current project and iteration. These hits will be submitted based on the currently generated hits for this project and iteration. You can view those in the table below. If you would like different task assignments then change them here: [insert button that leads to generate hit assignment]',\r\n                        component: <SubmitHits />\r\n                    },\r\n                    {\r\n                        urlName: 'hit_statuses',\r\n                        name: 'HIT Statuses',\r\n                        description: 'Display the status of all of the hits that are currently running on MTurk. You can use this information to determine how quickly hits are coming in.',\r\n                        component: <HitStatuses />\r\n                    },\r\n                    {\r\n                        urlName: 'cancel_hits',\r\n                        name: 'Cancel HITs',\r\n                        description: 'Allows you to cancel all hits for all accounts listed in the current credentials file.',\r\n                        component: <CancelHits />\r\n                    },\r\n                    {\r\n                        urlName: 'download_logs',\r\n                        name: 'Download Logs',\r\n                        description: 'Allows you to download all logs for a given project and iteration.',\r\n                        component: <DownloadZip />\r\n                    },\r\n                    {\r\n                        urlName: 'pay_hits',\r\n                        name: 'Pay HITs',\r\n                        description: 'Allows you to pay hits if given a csv file of payment details.',\r\n                        component: <PayHits />\r\n                    }\r\n                ]}\r\n        >\r\n            <ProjectIterationSelector />\r\n        </Tab>\r\n    }\r\n\r\n}\r\n\r\nexport class PostHitManagementTab extends React.Component<ConcreteTabProps, {}> {\r\n\r\n    render() {\r\n        return <Tab\r\n            tabRef={this.props.tabRef}\r\n            display={this.props.display}\r\n            actions={[]}\r\n        />\r\n    }\r\n\r\n}\r\n\r\nexport class SessionManagementTab extends React.Component<ConcreteTabProps, {}> {\r\n\r\n    render() {\r\n        return <Tab\r\n            tabRef={this.props.tabRef}\r\n            display={this.props.display}\r\n            actions={\r\n                [\r\n                    {\r\n                        urlName: 'load_student_credentials',\r\n                        name: 'Load Student Credentials',\r\n                        description: 'Load in student credentials if you need to interact with students and/or their Mturk accounts.',\r\n                        component:\r\n                            <div>\r\n                                <StudentFileInput />\r\n                                <ButtonWithDescription\r\n                                    buttonTitle={'Download CSV Template...'}\r\n                                    description={'This will download a CSV Template that you can then fill out with student credentials. This template has correctly spelt and formatted headers so that there are no validation errors when uploading it later.'}\r\n                                    buttonClass={'safe'}\r\n                                    onClick={() => {\r\n                                        const uri = 'data:text/plain;charset=utf-8,' + encodeURIComponent(\"WUSTL Key,AWS IAM ID,AWS IAM SECRET\\n\");\r\n                                        const a = document.createElement('a');\r\n                                        a.style.display = 'none';\r\n                                        a.href = uri;\r\n                                        a.download = 'student-credentials.csv';\r\n                                        document.body.appendChild(a);\r\n                                        a.click();\r\n                                        a.remove();\r\n                                    }}\r\n                                    display={true}\r\n                                />\r\n                            </div>\r\n                    },\r\n                    {\r\n                        urlName: 'logout',\r\n                        name: 'Logout',\r\n                        description: 'Use this to log out of the application.',\r\n                        component: <Logout />\r\n                    },\r\n                ]}\r\n        />\r\n    }\r\n\r\n}\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      process.env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './app/App';\r\nimport * as serviceWorker from './service-worker/serviceWorker';\r\nimport { Provider } from 'react-redux';\r\nimport {store} from \"./redux/store\";\r\n\r\nReactDOM.render(\r\n    <Provider store={store}>\r\n        <App />\r\n    </Provider>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}